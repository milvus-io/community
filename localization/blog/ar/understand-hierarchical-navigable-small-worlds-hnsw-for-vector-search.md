---
id: understand-hierarchical-navigable-small-worlds-hnsw-for-vector-search.md
title: فهم العوالم الصغيرة القابلة للملاحة الهرمية (HNSW) للبحث عن المتجهات
author: Stefan Webb
date: 2025-05-21T00:00:00.000Z
desc: >-
  HNSW (العالم الصغير القابل للملاحة الهرمي) هي خوارزمية فعالة للبحث التقريبي عن
  أقرب جار باستخدام بنية رسم بياني متعدد الطبقات.
cover: assets.zilliz.com/Chat_GPT_Image_May_26_2025_11_56_17_AM_1a84d31090.png
tag: Engineering
recommend: false
publishToMedium: true
tags: 'Milvus, vector database, vector search'
meta_keywords: 'Milvus, HNSW, Hierarchical Navigable Small Worlds, RAG, vector search'
meta_title: |
  Understand HNSW for Vector Search
origin: >-
  https://milvus.io/blog/understand-hierarchical-navigable-small-worlds-hnsw-for-vector-search.md
---
<p>إن العملية الرئيسية <a href="https://milvus.io/blog/what-is-a-vector-database.md">لقواعد البيانات المتجهة</a> هي <em>البحث عن التشابه،</em> والتي تتضمن إيجاد أقرب الجيران في قاعدة البيانات إلى متجه الاستعلام، على سبيل المثال، عن طريق المسافة الإقليدية. تقوم الطريقة الساذجة بحساب المسافة من متجه الاستعلام إلى كل متجه مخزّن في قاعدة البيانات وأخذ أقرب أقرب متجه. ومع ذلك، من الواضح أن هذا لا يتناسب مع زيادة حجم قاعدة البيانات. عمليًا، لا يكون البحث الساذج عن التشابه عمليًا إلا في قواعد البيانات التي تحتوي على أقل من مليون متجه تقريبًا. كيف يمكننا توسيع نطاق بحثنا ليشمل عشرات ومئات الملايين، أو حتى مليارات المتجهات؟</p>
<p>
  <span class="img-wrapper">
    <img translate="no" src="https://assets.zilliz.com/Figure_Descending_a_hierarchy_of_vector_search_indices_cf9fb8060a.png" alt="" class="doc-image" id="" />
    <span></span>
  </span>
</p>
<p><em>الشكل: تسلسل هرمي تنازلي لمؤشرات البحث عن المتجهات</em></p>
<p>تم تطوير العديد من الخوارزميات وهياكل البيانات لتوسيع نطاق البحث عن التشابه في الفضاءات المتجهة عالية الأبعاد إلى تعقيد زمني دون الخطي. في هذه المقالة، سنقوم بشرح وتطبيق طريقة شائعة وفعالة تسمى العوالم الصغيرة الهرمية القابلة للتنقل (HNSW)، والتي غالبًا ما تكون الخيار الافتراضي لمجموعات البيانات المتجهة متوسطة الحجم. تنتمي هذه الطريقة إلى عائلة طرق البحث التي تُنشئ رسمًا بيانيًا فوق المتجهات، حيث تشير الرءوس إلى المتجهات والحواف إلى التشابه بينها. يتم إجراء البحث عن طريق التنقل في الرسم البياني، في أبسط الحالات، بالعبور الجشع إلى جار العقدة الحالية الأقرب إلى الاستعلام والتكرار حتى الوصول إلى الحد الأدنى المحلي.</p>
<p>سنشرح بمزيد من التفصيل كيف يتم إنشاء الرسم البياني للبحث، وكيف يمكّن الرسم البياني من البحث، وفي النهاية سنقوم بالربط إلى تطبيق HNSW، من إعدادي الخاص بلغة بايثون البسيطة.</p>
<h2 id="Navigable-Small-Worlds" class="common-anchor-header">عوالم صغيرة قابلة للملاحة<button data-href="#Navigable-Small-Worlds" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>
  <span class="img-wrapper">
    <img translate="no" src="https://assets.zilliz.com/Figure_NSW_graph_created_from_100_randomly_located_2_D_points_3ffccbd6a7.jpg" alt="" class="doc-image" id="" />
    <span></span>
  </span>
</p>
<p><em>الشكل: رسم بياني لـNSW تم إنشاؤه من 100 نقطة ثنائية الأبعاد عشوائيًا.</em></p>
<p>كما ذكرنا، ينشئ HNSW رسمًا بيانيًا للبحث دون اتصال بالإنترنت قبل أن نتمكن من إجراء استعلام. تعتمد الخوارزمية على عمل سابق، وهي طريقة تسمى العوالم الصغيرة القابلة للملاحة (NSW). سنقوم بشرح NSW أولاً، ومن ثم سيكون من البديهي أن ننتقل من هناك إلى NSW <em>الهرمي</em>. يمثل الرسم التوضيحي أعلاه رسمًا بيانيًا مبنيًا للبحث في NSW على متجهات ثنائية الأبعاد. في جميع الأمثلة أدناه، نقتصر على المتجهات ثنائية الأبعاد حتى نتمكن من تصورها.</p>
<h2 id="Constructing-the-Graph" class="common-anchor-header">إنشاء الرسم البياني<button data-href="#Constructing-the-Graph" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>إن NSW هو رسم بياني تمثل فيه الرؤوس المتجهات ويتم إنشاء الحواف بطريقة استدلالية من التشابه بين المتجهات بحيث يمكن الوصول إلى معظم المتجهات من أي مكان عبر عدد قليل من القفزات. وهذا ما يسمى بخاصية "العالم الصغير" التي تسمح بالتنقل السريع. انظر الشكل أعلاه.</p>
<p>يتم تهيئة الرسم البياني ليكون فارغًا. نكرر المتجهات ونضيف كل منها إلى الرسم البياني تباعًا. بالنسبة لكل متجه، بدءًا من عقدة دخول عشوائية، نبحث بشراهة عن أقرب عقد R يمكن الوصول إليها من نقطة الدخول <em>في الرسم البياني الذي تم إنشاؤه حتى الآن</em>. ثم يتم توصيل عقد R هذه بعقدة جديدة تمثّل المتجه الذي يتم إدراجه، مع تشذيب أي عقد مجاورة لها الآن أكثر من R جيران. سيؤدي تكرار هذه العملية لجميع المتجهات إلى الحصول على الرسم البياني NSW. انظر الرسم التوضيحي أعلاه الذي يصور الخوارزمية، وراجع المصادر في نهاية المقال للاطلاع على تحليل نظري لخصائص الرسم البياني الذي تم إنشاؤه على هذا النحو.</p>
<h2 id="Searching-the-Graph" class="common-anchor-header">البحث في الرسم البياني<button data-href="#Searching-the-Graph" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>لقد رأينا بالفعل خوارزمية البحث من استخدامها في بناء الرسم البياني. لكن في هذه الحالة، يتم توفير عقدة الاستعلام من قبل المستخدم، بدلًا من أن تكون عقدة للإدراج في الرسم البياني. بدءًا من ملاحظة إدخال عشوائي، ننتقل بشراهة إلى جاره الأقرب إلى الاستعلام، مع الاحتفاظ بمجموعة ديناميكية من أقرب المتجهات التي تمت مواجهتها حتى الآن. انظر الرسم التوضيحي أعلاه. لاحظ أنه يمكننا تحسين دقة البحث من خلال بدء عمليات البحث من عدة نقاط دخول عشوائية وتجميع النتائج، إلى جانب النظر في عدة جيران في كل خطوة. ومع ذلك، تأتي هذه التحسينات على حساب زيادة وقت الاستجابة.</p>
<custom-h1>إضافة التسلسل الهرمي</custom-h1><p>
  <span class="img-wrapper">
    <img translate="no" src="https://assets.zilliz.com/adding_hierarchy_0101234812.png" alt="" class="doc-image" id="" />
    <span></span>
  </span>
</p>
<p>لقد وصفنا حتى الآن خوارزمية NSW وبنية البيانات التي يمكن أن تساعدنا في توسيع نطاق البحث في الفضاء عالي الأبعاد. ومع ذلك، تعاني هذه الطريقة من أوجه قصور خطيرة، بما في ذلك الفشل في الأبعاد المنخفضة، وبطء تقارب البحث، والميل إلى الوقوع في الحدود الدنيا المحلية.</p>
<p>يعالج مؤلفو HNSW هذه العيوب من خلال ثلاثة تعديلات على NSW:</p>
<ul>
<li><p>الاختيار الصريح لعقد الدخول أثناء البناء والبحث;</p></li>
<li><p>فصل الحواف بمقاييس مختلفة؛ و,</p></li>
<li><p>استخدام إرشادات متقدمة لاختيار الجيران.</p></li>
</ul>
<p>يتم تحقيق أول تعديلين بفكرة بسيطة: بناء <em>تسلسل هرمي من الرسوم البيانية للبحث</em>. بدلاً من رسم بياني واحد، كما هو الحال في NSW، يقوم HNSW ببناء تسلسل هرمي من الرسوم البيانية. يتم البحث في كل رسم بياني، أو طبقة، بشكل فردي بنفس طريقة NSW. تحتوي الطبقة العلوية، التي يتم البحث فيها أولاً، على عدد قليل جدًا من العقد، وتتضمن الطبقات الأعمق تدريجيًا المزيد والمزيد من العقد، مع تضمين الطبقة السفلية جميع العقد. هذا يعني أن الطبقات العليا تحتوي على قفزات أطول عبر فضاء المتجه، مما يسمح بنوع من البحث من المسار إلى البحث الدقيق. انظر أعلاه للحصول على رسم توضيحي.</p>
<h2 id="Constructing-the-Graph" class="common-anchor-header">بناء الرسم البياني<button data-href="#Constructing-the-Graph" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>تعمل خوارزمية البناء على النحو التالي: نحدد عددًا من الطبقات، <em>L،</em> مسبقًا. ستتوافق القيمة l=1 مع الطبقة الأكثر خشونة، حيث يبدأ البحث، وستتوافق القيمة l=L مع الطبقة الأكثر كثافة، حيث ينتهي البحث. نقوم بالتكرار من خلال كل متجه يتم إدراجه ونأخذ عينة من طبقة الإدراج باتباع <a href="https://en.wikipedia.org/wiki/Geometric_distribution">توزيع هندسي</a> مبتور (إما برفض <em>l &gt; L</em> أو تعيين <em>l' =</em> min_(l، L) _). لنفترض أننا نأخذ عينة <em>1 &lt; l &lt; L</em> للمتجه الحالي. نُجري بحثًا جشعًا على الطبقة العليا، L، حتى نصل إلى الحد الأدنى المحلي لها. بعد ذلك، نتبع حافة من الحد الأدنى المحلي في الطبقة _L_ إلى المتجه المقابل في الطبقة _(L-1)_ ونستخدمها كنقطة دخول للبحث الجشع في الطبقة _(L-1)_.</p>
<p>تتكرر هذه العملية حتى نصل إلى الطبقة _(ل-1) _الطبقة. ثم نبدأ بعد ذلك في إنشاء عقد للمتجه المراد إدراجه، وربطه بأقرب جيرانه الذين تم العثور عليهم عن طريق البحث الجشع في الطبقة _(ل-1) _ التي تم إنشاؤها حتى الآن، والانتقال إلى الطبقة _(ل-1) _ وتكرار العملية حتى ندخل المتجه في الطبقة _1_ الأولى. يوضح الرسم المتحرك أعلاه هذا الأمر</p>
<p>يمكننا أن نرى أن طريقة بناء الرسم البياني الهرمي هذه تستخدم اختيارًا صريحًا ذكيًا لعقدة الإدراج لكل متجه. نبحث في الطبقات الموجودة أعلى طبقة الإدراج التي تم إنشاؤها حتى الآن، ونبحث بكفاءة من المسافات من المسار إلى المسافات الدقيقة. وفي سياق متصل، تفصل هذه الطريقة بين الروابط بمقاييس مختلفة في كل طبقة: توفر الطبقة العليا قفزات طويلة النطاق عبر مساحة البحث، مع تناقص المقياس نزولاً إلى الطبقة السفلى. يساعد هذان التعديلان على تجنب الوقوع في الحد الأدنى دون المستوى الأمثل، ويسرع من تقارب البحث على حساب ذاكرة إضافية.</p>
<h2 id="Searching-the-Graph" class="common-anchor-header">البحث في الرسم البياني<button data-href="#Searching-the-Graph" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>يعمل إجراء البحث يشبه إلى حد كبير خطوة بناء الرسم البياني الداخلي. بدءًا من الطبقة العليا، ننتقل بشراهة إلى العقدة أو العقد الأقرب إلى الاستعلام. ثم نتبع تلك العقدة (العقد) نزولاً إلى الطبقة التالية ونكرر العملية. نحصل على إجابتنا من خلال قائمة الجيران الأقرب <em>R</em> في الطبقة السفلية، كما هو موضّح في الرسم المتحرك أعلاه.</p>
<h2 id="Conclusion" class="common-anchor-header">الخلاصة<button data-href="#Conclusion" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>توفر قواعد البيانات المتجهة مثل ميلفوس تطبيقات مُحسَّنة ومضبوطة للغاية لـ HNSW، وغالبًا ما يكون أفضل فهرس بحث افتراضي لمجموعات البيانات التي تتسع لها الذاكرة.</p>
<p>لقد قمنا برسم نظرة عامة رفيعة المستوى لكيفية عمل HNSW وسبب عمله، مفضلين التصورات والحدس على النظرية والرياضيات. وبالتالي، فقد أغفلنا وصفًا دقيقًا لخوارزميات البناء والبحث<a href="https://arxiv.org/abs/1603.09320">[Malkov and Yashushin, 2016</a>; Alg 1-3]، وتحليل تعقيد البحث والبناء<a href="https://arxiv.org/abs/1603.09320">[Malkov and Yashushin, 2016</a>; §4.2]، وتفاصيل أقل أهمية مثل الاستدلال لاختيار العقد المجاورة بشكل أكثر فعالية أثناء البناء<a href="https://arxiv.org/abs/1603.09320">[Malkov and Yashushin, 2016</a>; Alg 5]. علاوة على ذلك، فقد أغفلنا مناقشة المعلمات الفائقة للخوارزمية ومعناها وكيفية تأثيرها على مفاضلة زمن الاستجابة/السرعة/الذاكرة<a href="https://arxiv.org/abs/1603.09320">[Malkov and Yashushin, 2016</a>; §4.1]. إن فهم هذا الأمر مهم لاستخدام HNSW في الممارسة العملية.</p>
<p>تحتوي الموارد أدناه على مزيد من القراءة حول هذه الموضوعات وتطبيق تربوي كامل بلغة Python (كتبته بنفسي) ل NSW و HNSW، بما في ذلك كود لإنتاج الرسوم المتحركة في هذه المقالة.</p>
<custom-h1>الموارد</custom-h1><ul>
<li><p>جيثب: "<a href="https://github.com/stefanwebb/hnsw-illustrated">HNSW-Illustrated: تطبيق صغير للعوالم الصغيرة القابلة للتنقل الهرمي (HNSW)، وهي خوارزمية بحث متجه لأغراض التعلم</a>"</p></li>
<li><p><a href="https://milvus.io/docs/hnsw.md#HNSW">HNSW | وثائق ميلفوس</a></p></li>
<li><p><a href="https://zilliz.com/learn/hierarchical-navigable-small-worlds-HNSW">فهم العوالم الصغيرة الهرمية القابلة للملاحة الهرمية (HNSW) - Zilliz Learn</a></p></li>
<li><p>ورقة HNSW: "<a href="https://arxiv.org/abs/1603.09320">بحث أقرب جار تقريبي فعال وقوي باستخدام رسوم بيانية هرمية لعوالم صغيرة قابلة للملاحة الهرمية</a>"</p></li>
<li><p>ورقة NSW: "<a href="https://publications.hse.ru/pubs/share/folder/x5p6h7thif/128296059.pdf">خوارزمية الجار الأقرب التقريبية التقريبية القائمة على الرسوم البيانية للعالم الصغير القابل للملاحة</a>"</p></li>
</ul>
