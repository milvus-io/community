---
id: dynamic-data-update-and-query-milvus.md
title: التحضير
author: milvus
date: 2020-04-13T21:02:08.632Z
desc: أصبح البحث عن المتجهات الآن أكثر سهولة وملاءمة
cover: assets.zilliz.com/header_62d7b8c823.png
tag: Engineering
canonicalUrl: 'https://zilliz.com/blog/dynamic-data-update-and-query-milvus'
---
<custom-h1>كيف يقوم ميلفوس بتنفيذ التحديث الديناميكي للبيانات والاستعلام عنها</custom-h1><p>في هذه المقالة، سنقوم بشكل أساسي بوصف كيفية تسجيل البيانات المتجهة في ذاكرة ميلفوس وكيفية الحفاظ على هذه السجلات.</p>
<p>فيما يلي أهداف التصميم الرئيسية لدينا:</p>
<ol>
<li>يجب أن تكون كفاءة استيراد البيانات عالية.</li>
<li>يمكن رؤية البيانات في أقرب وقت ممكن بعد استيراد البيانات.</li>
<li>تجنب تجزئة ملفات البيانات.</li>
</ol>
<p>لذلك، أنشأنا مخزن ذاكرة مؤقت (مخزن إدراج مؤقت) لإدخال البيانات لتقليل عدد عمليات تبديل سياق الإدخال والإخراج العشوائي على القرص ونظام التشغيل لتحسين أداء إدخال البيانات. تمكننا بنية تخزين الذاكرة المستندة إلى MemTable و MemTableFile من إدارة البيانات وتسلسلها بشكل أكثر ملاءمة. يتم تقسيم حالة المخزن المؤقت إلى قابل للتغيير وغير قابل للتغيير، مما يسمح باستمرار البيانات على القرص مع الحفاظ على الخدمات الخارجية متاحة.</p>
<h2 id="Preparation" class="common-anchor-header">التحضير<button data-href="#Preparation" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>عندما يكون المستخدم جاهزًا لإدراج متجه في ميلفوس، يحتاج أولًا إلى إنشاء مجموعة (* يعيد ميلفوس تسمية الجدول إلى مجموعة في الإصدار 0.7.0). المجموعة هي الوحدة الأساسية لتسجيل المتجهات والبحث عنها في ملفوس.</p>
<p>تحتوي كل مجموعة على اسم فريد وبعض الخصائص التي يمكن تعيينها، ويتم إدراج المتجهات أو البحث عنها بناءً على اسم المجموعة. عند إنشاء مجموعة جديدة، تقوم ميلفوس بتسجيل معلومات هذه المجموعة في البيانات الوصفية.</p>
<h2 id="Data-Insertion" class="common-anchor-header">إدراج البيانات<button data-href="#Data-Insertion" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>عندما يرسل المستخدم طلبًا لإدراج البيانات، يتم تسلسل البيانات وإلغاء تسلسلها للوصول إلى خادم Milvus. تتم الآن كتابة البيانات في الذاكرة. تنقسم كتابة الذاكرة تقريبًا إلى الخطوات التالية:</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/2_data_insertion_milvus_99448bae50.png" alt="2-data-insertion-milvus.png" class="doc-image" id="2-data-insertion-milvus.png" />
   </span> <span class="img-wrapper"> <span>2-إدخال البيانات-إدراج-ملفوس.png</span> </span></p>
<ol>
<li>في MemManager، ابحث عن MemTable جديد أو أنشئ MemTable جديدًا مطابقًا لاسم المجموعة. يتوافق كل MemTable مع مخزن مؤقت للمجموعة في الذاكرة.</li>
<li>سيحتوي جدول MemTable على ملف MemTableFile واحد أو أكثر. كلما أنشأنا ملف MemTableFile جديد، سنقوم بتسجيل هذه المعلومات في Meta في نفس الوقت. نقسم ملف MemTableFile إلى حالتين: قابل للتغيير وغير قابل للتغيير. عندما يصل حجم ملف MemTableFile إلى الحد الأدنى، سيصبح غير قابل للتغيير. يمكن لكل MemTable Table أن يحتوي على ملف MemTableFile واحد فقط قابل للتغيير ليتم كتابته في أي وقت.</li>
<li>سيتم تسجيل بيانات كل ملف MemTableFile في النهاية في الذاكرة بتنسيق نوع الفهرس المحدد. MemTableFile هو الوحدة الأساسية لإدارة البيانات في الذاكرة.</li>
<li>في أي وقت، لن يتجاوز استخدام الذاكرة للبيانات المدرجة القيمة المحددة مسبقاً (insert_buffer_size). هذا لأن كل طلب لإدراج البيانات يأتي، يمكن لـ MemManager بسهولة حساب الذاكرة التي يشغلها MemTableFile الموجود في كل MemTable، ومن ثم تنسيق طلب الإدراج وفقًا للذاكرة الحالية.</li>
</ol>
<p>من خلال بنية MemManager و MemTable و MemTableFile متعددة المستويات، يمكن إدارة إدراج البيانات وصيانتها بشكل أفضل. بالطبع، يمكنهم القيام بأكثر من ذلك بكثير.</p>
<h2 id="Near-Real-time-Query" class="common-anchor-header">استعلام شبه فوري<button data-href="#Near-Real-time-Query" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>في Milvus، تحتاج فقط إلى الانتظار لمدة ثانية واحدة على أقصى تقدير حتى تنتقل البيانات المدرجة من الذاكرة إلى القرص. يمكن تلخيص هذه العملية بأكملها تقريبًا بالصورة التالية:</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/2_near_real_time_query_milvus_f3cfdd00fb.png" alt="2-near-real-time-query-milvus.png" class="doc-image" id="2-near-real-time-query-milvus.png" />
   </span> <span class="img-wrapper"> <span>2-near-real-time-query-milvus.png</span> </span></p>
<p>أولاً، ستدخل البيانات المدرجة إلى مخزن مؤقت للإدراج في الذاكرة. سيتغير المخزن المؤقت بشكل دوري من الحالة الأولية القابلة للتغيير إلى الحالة الثابتة استعدادًا للتسلسل. بعد ذلك، سيتم تسلسل هذه المخازن المؤقتة غير القابلة للتغيير إلى القرص بشكل دوري بواسطة مؤشر ترابط التسلسل في الخلفية. بعد وضع البيانات، سيتم تسجيل معلومات الترتيب في البيانات الوصفية. في هذه المرحلة، يمكن البحث في البيانات!</p>
<p>الآن، سنقوم بوصف الخطوات في الصورة بالتفصيل.</p>
<p>نحن نعلم بالفعل عملية إدراج البيانات في المخزن المؤقت القابل للتغيير. الخطوة التالية هي التبديل من المخزن المؤقت القابل للتغيير إلى المخزن المؤقت غير القابل للتغيير:</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/3_mutable_buffer_immutable_buffer_milvus_282b66c5fe.png" alt="3-mutable-buffer-immutable-buffer-milvus.png" class="doc-image" id="3-mutable-buffer-immutable-buffer-milvus.png" />
   </span> <span class="img-wrapper"> <span>3-المخزن المؤقت القابل للتغيير-المخزن المؤقت القابل للتغيير-المخزن المؤقت الثابت-ميلفوس.png</span> </span></p>
<p>ستزود قائمة الانتظار غير القابلة للتغيير مؤشر ترابط التسلسل في الخلفية بالحالة غير القابلة للتغيير وملف MemTableFile الجاهز للتسلسل. يدير كل MemTableable قائمة الانتظار غير القابلة للتغيير الخاصة به، وعندما يصل حجم ملف MemTableFile الوحيد القابل للتغيير في MemTable إلى الحد الأدنى، سيدخل إلى قائمة الانتظار غير القابلة للتغيير. سيقوم مؤشر ترابط في الخلفية مسؤول عن ToImmutable بسحب جميع ملفات MemTableFiles في قائمة الانتظار غير القابلة للتغيير التي تديرها MemTable بشكل دوري وإرسالها إلى قائمة الانتظار الإجمالية غير القابلة للتغيير. تجدر الإشارة إلى أن عمليتي كتابة البيانات في الذاكرة وتغيير البيانات الموجودة في الذاكرة إلى حالة لا يمكن كتابتها لا يمكن أن تحدثا في نفس الوقت، ويلزم وجود قفل مشترك. ومع ذلك، فإن عملية ToImmutable بسيطة للغاية ولا تسبب أي تأخير تقريبًا، لذا فإن تأثير الأداء على البيانات المدرجة يكون ضئيلًا للغاية.</p>
<p>الخطوة التالية هي تسلسل ملف MemTableFile في قائمة انتظار التسلسل إلى القرص. ينقسم هذا بشكل أساسي إلى ثلاث خطوات:</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/4_serialize_memtablefile_milvus_95766abdfb.png" alt="4-serialize-memtablefile-milvus.png" class="doc-image" id="4-serialize-memtablefile-milvus.png" />
   </span> <span class="img-wrapper"> <span>4-تسلسل ملف MemTablefile-memtablefile-milvus.png</span> </span></p>
<p>أولاً، سيقوم مؤشر ترابط التسلسل في الخلفية بسحب ملفات MemTableFile بشكل دوري من قائمة الانتظار الثابتة. بعد ذلك، يتم تسلسلها إلى ملفات خام ذات حجم ثابت (Raw TableFiles). أخيرًا، سنسجل هذه المعلومات في البيانات الوصفية. عندما نجري بحثًا متجهًا، سنستعلم عن TableFile المقابل في البيانات الوصفية. من هنا، يمكن البحث عن هذه البيانات!</p>
<p>بالإضافة إلى ذلك، وفقًا للمجموعة index_file_size، بعد أن يكمل مؤشر ترابط التسلسل دورة التسلسل، سيقوم بدمج بعض ملفات TableFiles ذات الحجم الثابت في TableFile، وتسجيل هذه المعلومات أيضًا في البيانات الوصفية. في هذا الوقت، يمكن فهرسة TableFile. بناء الفهرس غير متزامن أيضًا. سيقوم مؤشر ترابط آخر في الخلفية مسؤول عن بناء الفهرس بقراءة TableFile بشكل دوري في حالة ToIndex للبيانات الوصفية لتنفيذ بناء الفهرس المقابل.</p>
<h2 id="Vector-search" class="common-anchor-header">البحث المتجه<button data-href="#Vector-search" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>في الواقع، ستجد أنه بمساعدة TableFile والبيانات الوصفية يصبح البحث المتجه أكثر سهولة وملاءمة. بشكل عام، نحن بحاجة إلى الحصول على ملفات TableFiles المطابقة للمجموعة التي تم الاستعلام عنها من بيانات التعريف، والبحث في كل ملف TableFile، وأخيرًا الدمج. في هذه المقالة، لا نخوض في التنفيذ المحدد للبحث.</p>
<p>إذا كنت ترغب في معرفة المزيد، فمرحبًا بك في قراءة الكود المصدري، أو قراءة مقالاتنا التقنية الأخرى حول ميلفوس!</p>
