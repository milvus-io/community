---
id: building-a-personalized-product-recommender-system-with-vipshop-and-milvus.md
title: البنية الشاملة
author: milvus
date: 2021-07-29T08:46:39.920Z
desc: تسهّل شركة Milvus تقديم خدمة التوصيات المخصصة للمستخدمين.
cover: assets.zilliz.com/blog_shopping_27fba2c990.jpg
tag: Scenarios
canonicalUrl: >-
  https://zilliz.com/blog/building-a-personalized-product-recommender-system-with-vipshop-and-milvus
---
<custom-h1>بناء نظام التوصية بالمنتجات المخصص مع فيب شوب وميلفوس</custom-h1><p>مع النمو الهائل لنطاق بيانات الإنترنت، تزداد كمية المنتجات وكذلك الفئة في منصة التجارة الإلكترونية السائدة حاليًا من ناحية، وتزداد صعوبة عثور المستخدمين على المنتجات التي يحتاجونها من ناحية أخرى.</p>
<p><a href="https://www.vip.com/">شركة Vipshop</a> هي شركة رائدة في مجال البيع بالتجزئة للعلامات التجارية عبر الإنترنت للعلامات التجارية في الصين. تقدم الشركة منتجات عالية الجودة وذات علامات تجارية شهيرة للمستهلكين في جميع أنحاء الصين بخصم كبير عن أسعار التجزئة. ولتحسين تجربة التسوق لعملائها، قررت الشركة بناء نظام توصية بحث مخصص يعتمد على الكلمات الرئيسية لاستعلام المستخدم وصور المستخدم.</p>
<p>وتتمثل الوظيفة الأساسية لنظام توصيات البحث في التجارة الإلكترونية في استرداد المنتجات المناسبة من عدد كبير من المنتجات وعرضها على المستخدمين وفقًا لقصد البحث وتفضيلاتهم. في هذه العملية، يحتاج النظام إلى حساب التشابه بين المنتجات ونوايا بحث المستخدمين وتفضيلاتهم، ويوصي بأفضل المنتجات ذات التشابه الأعلى للمستخدمين.</p>
<p>البيانات مثل معلومات المنتج ونية بحث المستخدم وتفضيلاته كلها بيانات غير منظمة. لقد حاولنا حساب تشابه هذه البيانات باستخدام CosineSimilarity(7.x) من محرك البحث Elasticsearch (ES)، ولكن هذا النهج له العيوب التالية</p>
<ul>
<li><p>وقت الاستجابة الحسابي الطويل - يبلغ متوسط زمن الاستجابة الحسابية لاسترداد نتائج TopK من ملايين العناصر حوالي 300 مللي ثانية.</p></li>
<li><p>تكلفة الصيانة العالية لفهارس ES - يتم استخدام نفس مجموعة الفهارس لكل من ناقلات ميزات السلع والبيانات الأخرى ذات الصلة، مما يسهل بالكاد بناء الفهرس، ولكنه ينتج عنه كمية هائلة من البيانات.</p></li>
</ul>
<p>لقد حاولنا تطوير مكون التجزئة الإضافي الحساس محليًا الخاص بنا لتسريع حساب CosineSimilarity لـ ES. على الرغم من تحسن الأداء والإنتاجية بشكل كبير بعد التسريع، إلا أن زمن الاستجابة الذي يزيد عن 100 مللي ثانية كان لا يزال من الصعب تلبية متطلبات استرجاع المنتجات الفعلية عبر الإنترنت.</p>
<p>بعد إجراء بحث شامل، قررنا استخدام Milvus، وهي قاعدة بيانات متجهة مفتوحة المصدر، والتي تتميز بدعم النشر الموزع، وحزم SDK متعددة اللغات، وفصل القراءة/الكتابة، وما إلى ذلك، مقارنةً بـ Faiss المستقل شائع الاستخدام.</p>
<p>باستخدام نماذج مختلفة للتعلم العميق، نقوم بتحويل البيانات الضخمة غير المهيكلة إلى متجهات مميزة، واستيراد المتجهات إلى Milvus. وبفضل الأداء الممتاز لـ Milvus، يمكن لنظام توصيات البحث في التجارة الإلكترونية الخاص بنا الاستعلام بكفاءة عن متجهات TopK المشابهة للمتجهات المستهدفة.</p>
<h2 id="Overall-Architecture" class="common-anchor-header">البنية الشاملة<button data-href="#Overall-Architecture" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>![الهندسة المعمارية] (https://assets.zilliz.com/1_01551e7b2b.jpg &quot;الهندسة المعمارية.) كما هو موضح في الرسم التخطيطي، تتكون البنية الكلية للنظام من جزأين رئيسيين.</p>
<ul>
<li><p>عملية الكتابة: يتم تطبيع ناقلات سمات العنصر (المشار إليها فيما يلي باسم ناقلات العناصر) التي تم إنشاؤها بواسطة نموذج التعلم العميق وكتابتها في MySQL. ثم تقوم MySQL بقراءة متجهات سمات العناصر المعالجة باستخدام أداة مزامنة البيانات (ETL) واستيرادها إلى قاعدة بيانات المتجهات Milvus.</p></li>
<li><p>عملية القراءة: تحصل خدمة البحث على متجهات ميزات تفضيلات المستخدم (يشار إليها فيما يلي باسم متجهات المستخدم) بناءً على الكلمات الرئيسية لاستعلام المستخدم وصور المستخدم، وتستعلم عن المتجهات المماثلة في Milvus وتستدعي متجهات العناصر TopK.</p></li>
</ul>
<p>يدعم Milvus كلاً من التحديث التدريجي للبيانات والتحديث الكامل للبيانات. يجب على كل تحديث تزايدي حذف متجه العنصر الموجود وإدراج متجه عنصر جديد، مما يعني أنه سيتم إعادة فهرسة كل مجموعة تم تحديثها حديثًا. يناسب هذا السيناريو بشكل أفضل مع قراءات أكثر وكتابات أقل. لذلك، نختار طريقة تحديث البيانات بالكامل. علاوة على ذلك، يستغرق الأمر بضع دقائق فقط لكتابة البيانات بأكملها على دفعات من أقسام متعددة، وهو ما يعادل تحديثات شبه فورية.</p>
<p>تقوم عقد الكتابة في Milvus بتنفيذ جميع عمليات الكتابة، بما في ذلك إنشاء مجموعات البيانات، وبناء الفهارس، وإدراج المتجهات، وما إلى ذلك، وتقديم الخدمات للجمهور بأسماء نطاقات الكتابة. تقوم عقد القراءة Milvus بتنفيذ جميع عمليات القراءة وتقدم خدمات للجمهور بأسماء نطاقات للقراءة فقط.</p>
<p>في حين أن الإصدار الحالي من Milvus لا يدعم تبديل الأسماء المستعارة للمجموعات، فإننا نقدم Redis لتبديل الأسماء المستعارة بسلاسة بين مجموعات بيانات متعددة كاملة.</p>
<p>تحتاج عقدة القراءة فقط إلى قراءة معلومات البيانات الوصفية الموجودة وبيانات المتجهات أو الفهارس من MySQL وMilvus ونظام الملفات الموزعة GlusterFS، لذلك يمكن توسيع إمكانية القراءة أفقياً عن طريق نشر مثيلات متعددة.</p>
<h2 id="Implementation-Details" class="common-anchor-header">تفاصيل التنفيذ<button data-href="#Implementation-Details" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><h3 id="Data-Update" class="common-anchor-header">تحديث البيانات</h3><p>لا تتضمن خدمة تحديث البيانات كتابة البيانات المتجهة فحسب، بل تشمل أيضًا اكتشاف حجم البيانات المتجهة وإنشاء الفهرس والتحميل المسبق للفهرس والتحكم في الأسماء المستعارة وما إلى ذلك. وتتم العملية الشاملة على النحو التالي. <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/2_6052b01334.jpg" alt="Process" class="doc-image" id="process" /><span>العملية</span> </span></p>
<ol>
<li><p>لنفترض أنه قبل بناء البيانات بالكامل، توفر المجموعة أ خدمة البيانات للجمهور، ويتم توجيه البيانات المستخدمة بالكامل إلى المجموعة أ (<code translate="no">redis key1 = CollectionA</code>). الغرض من بناء كامل البيانات هو إنشاء مجموعة جديدة CollectionB.</p></li>
<li><p>التحقق من بيانات السلع - التحقق من رقم الصنف لبيانات السلع في جدول MySQL، ومقارنة بيانات السلع بالبيانات الموجودة في المجموعةA. يمكن تعيين التنبيه وفقًا للكمية أو النسبة المئوية. إذا لم يتم الوصول إلى الكمية المحددة (النسبة المئوية)، لن يتم بناء البيانات بالكامل، وسيتم اعتبار ذلك بمثابة فشل عملية البناء هذه، مما يؤدي إلى إطلاق التنبيه؛ بمجرد الوصول إلى الكمية المحددة (النسبة المئوية)، تبدأ عملية بناء البيانات بالكامل.</p></li>
<li><p>ابدأ بناء البيانات بالكامل - قم بتهيئة الاسم المستعار للبيانات التي يتم بناؤها بالكامل، وقم بتحديث Redis. بعد التحديث، يتم توجيه الاسم المستعار لكامل البيانات الجاري بناؤها إلى المجموعة ب (<code translate="no">redis key2 = CollectionB</code>).</p></li>
<li><p>إنشاء مجموعة كاملة جديدة - تحديد ما إذا كانت المجموعة ب موجودة. إذا كانت موجودة، فاحذفها قبل إنشاء مجموعة جديدة.</p></li>
<li><p>كتابة البيانات على دفعات - احسب معرّف القسم لكل بيانات سلعة بمعرفها الخاص باستخدام عملية التعديل، واكتب البيانات إلى أقسام متعددة إلى المجموعة المنشأة حديثًا على دفعات.</p></li>
<li><p>إنشاء فهرس وتحميله مسبقًا - إنشاء فهرس (<code translate="no">createIndex()</code>) للمجموعة الجديدة. يتم تخزين ملف الفهرس في خادم التخزين الموزع GlusterFS. يقوم النظام تلقائيًا بمحاكاة الاستعلام على المجموعة الجديدة وتحميل الفهرس مسبقًا لإحماء الاستعلام.</p></li>
<li><p>التحقق من بيانات المجموعة - التحقق من رقم عنصر البيانات في المجموعة الجديدة، ومقارنة البيانات مع المجموعة الحالية، وتعيين الإنذارات بناءً على الكمية والنسبة المئوية. إذا لم يتم الوصول إلى الرقم المحدد (النسبة المئوية)، فلن يتم تبديل المجموعة وستعتبر عملية البناء فاشلة، مما يؤدي إلى إطلاق الإنذار.</p></li>
<li><p>تبديل المجموعة - التحكم في الاسم المستعار. بعد تحديث ريديس، يتم توجيه الاسم المستعار للبيانات المستخدمة بالكامل إلى المجموعة ب (<code translate="no">redis key1 = CollectionB</code>)، ويتم حذف مفتاح ريديس الأصلي2، وتكتمل عملية البناء.</p></li>
</ol>
<h3 id="Data-Recall" class="common-anchor-header">استدعاء البيانات</h3><p>يتم استدعاء بيانات قسم ميلفوس عدة مرات لحساب التشابه بين متجهات المستخدم، التي تم الحصول عليها بناءً على الكلمات الرئيسية لاستعلام المستخدم وصورة المستخدم، ومتجه العنصر، ويتم إرجاع متجهات العناصر TopK بعد الدمج. مخطط سير العمل الكلي كما يلي: <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/3_93518602b1.jpg" alt="workflow" class="doc-image" id="workflow" /><span>سير العمل</span> </span>يسرد الجدول التالي الخدمات الرئيسية المشاركة في هذه العملية. يمكن ملاحظة أن متوسط زمن الاستجابة لاستدعاء متجهات TopK يبلغ حوالي 30 مللي ثانية.</p>
<table>
<thead>
<tr><th><strong>الخدمة</strong></th><th><strong>الدور</strong></th><th><strong>معلمات الإدخال</strong></th><th><strong>معلمات الإخراج</strong></th><th><strong>زمن الاستجابة</strong></th></tr>
</thead>
<tbody>
<tr><td>الحصول على متجهات المستخدم</td><td>الحصول على متجه المستخدم</td><td>معلومات المستخدم + الاستعلام</td><td>متجه المستخدم</td><td>10 مللي ثانية</td></tr>
<tr><td>بحث ميلفوس</td><td>حساب تشابه المتجه وإرجاع نتائج TopK</td><td>متجه المستخدم</td><td>متجه العنصر</td><td>10 مللي ثانية</td></tr>
<tr><td>منطق الجدولة</td><td>استدعاء النتائج المتزامنة ودمجها</td><td>متجهات العناصر المسترجعة متعددة القنوات ودرجة التشابه</td><td>أعلىK العناصر</td><td>10 مللي ثانية</td></tr>
</tbody>
</table>
<p><strong>عملية التنفيذ:</strong></p>
<ol>
<li>بناءً على الكلمات الرئيسية لاستعلام المستخدم وصورة المستخدم، يتم حساب متجه المستخدم بواسطة نموذج التعلم العميق.</li>
<li>الحصول على الاسم المستعار للمجموعة لكامل البيانات المستخدمة من Redis currentInUseKeyKeyRef والحصول على اسم المجموعة Milvus CollectionName. هذه العملية هي خدمة مزامنة البيانات، أي تبديل الاسم المستعار إلى Redis بعد تحديث البيانات بالكامل.</li>
<li>يتم استدعاء Milvus بشكل متزامن وغير متزامن مع متجه المستخدم للحصول على البيانات من أقسام مختلفة من نفس المجموعة، ويحسب Milvus التشابه بين متجه المستخدم ومتجه العنصر، ويُرجع أفضل عدد من متجهات العناصر المتشابهة في كل قسم.</li>
<li>دمج متجهات العناصر TopK التي تم إرجاعها من كل قسم، وترتيب النتائج بالترتيب العكسي لمسافة التشابه، والتي يتم حسابها باستخدام الضرب الداخلي ل IP (كلما زادت المسافة بين المتجهات، كلما كانت أكثر تشابهًا). يتم إرجاع متجهات العناصر النهائية TopK.</li>
</ol>
<h2 id="Looking-Ahead" class="common-anchor-header">استشراف المستقبل<button data-href="#Looking-Ahead" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>في الوقت الحاضر، يمكن استخدام البحث المتجه المستند إلى ميلفوس بشكل مطرد في البحث عن سيناريوهات التوصية، ويمنحنا أداؤه العالي مساحة أكبر للعب في أبعاد النموذج واختيار الخوارزمية.</p>
<p>ستلعب Milvus دورًا حاسمًا كبرنامج وسيط لمزيد من السيناريوهات، بما في ذلك استدعاء البحث في الموقع الرئيسي وتوصيات جميع السيناريوهات.</p>
<p>فيما يلي أهم ثلاث ميزات متوقعة من ميلفوس في المستقبل</p>
<ul>
<li>منطق تبديل الأسماء المستعارة للمجموعات - تنسيق التبديل عبر المجموعات بدون مكونات خارجية.</li>
<li>آلية التصفية - يدعم Milvus v0.11.0 الإصدار 0.11.0 آلية تصفية ES DSL فقط في الإصدار المستقل. يدعم الإصدار Milvus 2.0 الذي تم إصداره حديثًا التصفية العددية وفصل القراءة/الكتابة.</li>
<li>دعم التخزين لنظام ملفات Hadoop الموزعة (HDFS) - يدعم الإصدار Milvus v0.10.6 الذي نستخدمه واجهة ملفات POSIX فقط، وقد نشرنا GlusterFS مع دعم FUSE كواجهة تخزين خلفية. ومع ذلك، فإن HDFS هو الخيار الأفضل من حيث الأداء وسهولة التوسع.</li>
</ul>
<h2 id="Lessons-Learned-and-Best-Practices" class="common-anchor-header">الدروس المستفادة وأفضل الممارسات<button data-href="#Lessons-Learned-and-Best-Practices" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><ol>
<li>بالنسبة للتطبيقات التي تكون فيها عمليات القراءة هي التركيز الأساسي، يمكن أن يؤدي نشر فصل القراءة عن الكتابة إلى زيادة قوة المعالجة وتحسين الأداء بشكل كبير.</li>
<li>يفتقر عميل Milvus Java إلى آلية إعادة الاتصال لأن عميل Milvus الذي تستخدمه خدمة الاستدعاء مقيم في الذاكرة. يتعين علينا بناء تجمع الاتصال الخاص بنا لضمان توافر الاتصال بين عميل جافا والخادم من خلال اختبار نبضات القلب.</li>
<li>تحدث استعلامات بطيئة في بعض الأحيان على Milvus. ويرجع ذلك إلى عدم كفاية إحماء المجموعة الجديدة. من خلال محاكاة الاستعلام على المجموعة الجديدة، يتم تحميل ملف الفهرس في الذاكرة لتحقيق إحماء الفهرس.</li>
<li>nlist هي معلمة بناء الفهرس و nprobe هي معلمة الاستعلام. تحتاج إلى الحصول على قيمة عتبة معقولة وفقًا لسيناريو عملك من خلال تجارب اختبار الضغط لتحقيق التوازن بين أداء الاسترجاع والدقة.</li>
<li>بالنسبة لسيناريو البيانات الثابتة، يكون من الأكثر كفاءة استيراد جميع البيانات إلى المجموعة أولاً وبناء الفهارس لاحقًا.</li>
</ol>
