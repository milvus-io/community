---
id: a-brief-introduction-to-the-scann-index.md
title: مقدمة موجزة عن مؤشر ScaNN
author: Jack Li
date: 2026-01-21T00:00:00.000Z
cover: assets.zilliz.com/scann_cover_9a9787ee8a.png
tag: Engineering
recommend: false
publishToMedium: true
tags: 'Milvus, vector database'
meta_keywords: 'ScaNN index, IVFPQ, vector similarity search, ANN, Milvus'
meta_title: |
  A Brief Introduction to the ScaNN Index and How It Improves IVFPQ
desc: >-
  غوص عميق في فهرس ScaNN: كيف يحسّن IVFPPQ مع التكميم الواعي بالدرجات وFastScan
  4 بت، بالإضافة إلى نتائج معيارية من Milvus على مجموعة بيانات Cohere1M.
origin: 'https://milvus.io/blog/a-brief-introduction-to-the-scann-index.md'
---
<p><a href="https://github.com/google-research/google-research/tree/master/scann">ScaNN</a> هي إجابة Google على تحدٍ مألوف في البحث المتجه واسع النطاق: <strong>كيفية زيادة إنتاجية الاستعلام وتقليل استخدام الذاكرة دون التأثير بشكل غير مقبول على جودة النتائج.</strong> من الناحية المفاهيمية، تبدأ ScaNN من الوصفة الكلاسيكية IVF+PQ - التجميع الخشن بالإضافة إلى تكميم المنتج القوي - ولكنها تعتمد على ابتكارين مهمين يحولان حدود الأداء بشكل هادف:</p>
<ul>
<li><p><strong>هدف التكميم الواعي بالدرجات</strong> الذي يحافظ بشكل أفضل على الترتيب النسبي للجيران الحقيقيين، مما يحسن جودة الترتيب حتى في ظل الضغط الشديد.</p></li>
<li><p><strong>FastScan</strong> عبارة عن مسار بحث PQ مُحسَّن مكون من 4 بت PQ مُحسَّن بـ SIMD يقلل من عنق الزجاجة التقليدي الذي يمثل عبء على الذاكرة من خلال الاحتفاظ بمزيد من العمل داخل سجلات وحدة المعالجة المركزية.</p></li>
</ul>
<p>في الممارسة العملية، يعد خيارًا قويًا عندما تكون موافقًا على مقايضة بعض الاستدعاء مقابل QPS عالية وبصمة ذاكرة أصغر بكثير (غالبًا ما تضغط المتجهات إلى حوالي 1/16 من الحجم الأصلي)، كما هو الحال في أعباء عمل التوصيات غير الحساسة للاستدعاء.</p>
<p>في هذا المنشور، سنعيد النظر في IVFPPQ كخط أساس، ونستكشف التحسينات الرئيسية التي يقدمها ScaNN فوقه، ونختتم بالنتائج التجريبية التي تؤسس المناقشة في الأداء المقاس.</p>
<h2 id="IVFPQ-Recap" class="common-anchor-header">خلاصة IVFPPQ<button data-href="#IVFPQ-Recap" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>تم اقتراح ScaNN من قِبل Google في عام 2020، وتشير الورقة البحثية إلى تحسن الأداء بمقدار 3 أضعاف مقارنةً ب HNSW على مجموعة بيانات GloVe. يمكنك الرجوع إلى <a href="https://arxiv.org/pdf/1908.10396.pdf">الورقة البحث</a> ية <a href="https://arxiv.org/pdf/1908.10396.pdf">الأصلية</a> <a href="https://github.com/google-research/google-research/tree/master/scann">والتنفيذ مفتوح المصدر</a> للحصول على التفاصيل.</p>
<p>قبل تقديم ScaNN، سنلخص بإيجاز IVFPPQ، نظرًا لأن ScaNN مبنية على نفس الإطار العام.</p>
<p>يرمز<strong>IVFFPPQ إلى الملف المقلوب مع تحديد كمية المنتج،</strong> وهي خوارزمية تُستخدم للبحث الفعال والواسع النطاق عن أقرب جار تقريبي (ANN) في قواعد البيانات المتجهة عالية الأبعاد. وهو عبارة عن نهج هجين يجمع بين تقنيتين، <strong>فهرس الملف المقلوب (IVF)</strong> وتكميم <strong>المنتج (PQ)</strong>، لتحقيق التوازن بين سرعة البحث واستخدام الذاكرة والدقة.</p>
<h3 id="How-IVFPQ-Works" class="common-anchor-header">كيف يعمل IVFPPQ</h3><p>تتضمن العملية خطوتين رئيسيتين أثناء الفهرسة والبحث:</p>
<ul>
<li>طبقة IVF: يتم تجميع المتجهات في قوائم (مجموعات) مقلوبة <code translate="no">nlist</code>. في وقت الاستعلام، تقوم بزيارة مجموعة فرعية فقط من المجموعات (<code translate="no">nprobe</code>) لمقايضة الاستدعاء والكمون/الإنتاجية.</li>
</ul>
<p>
  <span class="img-wrapper">
    <img translate="no" src="https://assets.zilliz.com/ivf1_5e3d29c392.png" alt="" class="doc-image" id="" />
    <span></span>
  </span>
</p>
<ul>
<li>طبقة PQ: داخل كل مجموعة تمت زيارتها، يتم تقسيم كل متجه ذي بُعد D إلى m متجهات فرعية، كل منها ذو بُعد (D/m). يتم تكميم كل متجه فرعي من خلال تعيينه إلى أقرب نقطة مركزية في دفتر الترميز الفرعي الخاص به. إذا كان دفتر الترميز الفرعي يحتوي على 256 مركزًا، فيمكن تمثيل كل متجه فرعي برمز <code translate="no">uint8</code> (معرّف في [0، 255]).</li>
</ul>
<p>
  <span class="img-wrapper">
    <img translate="no" src="https://assets.zilliz.com/pq2_6695c9cc6f.png" alt="" class="doc-image" id="" />
    <span></span>
  </span>
</p>
<p>يمكن بعد ذلك إعادة كتابة حساب المسافة على شكل مجموع على المتجهات الفرعية:</p>
<p><strong>D(q, X) = D(q, u0) + D(q, u1) + D(q, u2) + ... + D(q, un)</strong></p>
<p><strong>= L(q، id1) + L(q، id2) + L(q، id3) + ... + L(q، idn)</strong></p>
<p>يمثل L هنا جدول بحث. في وقت الاستعلام، يتم إنشاء جدول البحث، حيث يتم تسجيل المسافة بين الاستعلام وكل متجه فرعي كمي. يتم تحويل جميع عمليات حساب المسافة اللاحقة إلى عمليات بحث في الجدول متبوعة بالجمع.</p>
<p>
  <span class="img-wrapper">
    <img translate="no" src="https://assets.zilliz.com/query_vector3_75d47bdd53.png" alt="" class="doc-image" id="" />
    <span></span>
  </span>
</p>
<p>على سبيل المثال، بالنسبة إلى المتجهات ذات الـ 128 بُعدًا المقسمة إلى 32 متجهًا فرعيًا لكل منها 4 أبعاد، إذا تم ترميز كل متجه فرعي بمعرف <code translate="no">uint8</code> ، تنخفض تكلفة التخزين لكل متجه من (128 × 4) بايت إلى (32 × 1) بايت - أي بتخفيض 1/16.</p>
<h2 id="ScaNN-Optimizations-Based-on-IVFPQ" class="common-anchor-header">تحسينات ScaNN القائمة على IVFPPQ<button data-href="#ScaNN-Optimizations-Based-on-IVFPQ" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>باختصار، تعمل ScaNN على تحسين IVFPPQ في جانبين:</p>
<ol>
<li><p>التحديد الكمي: تقترح ScaNN هدفاً يتجاوز مجرد استبدال كل متجه فرعي بأقرب نقطة مركزية له من k-means (أي تقليل خطأ إعادة البناء).</p></li>
<li><p>كفاءة البحث: تعمل ScaNN على تسريع البحث القائم على LUT، والذي غالبًا ما يكون مرتبطًا بالذاكرة، من خلال مسار FastScan سهل الاستخدام SIMD.</p></li>
</ol>
<h3 id="Score-aware-Quantization-Loss" class="common-anchor-header">فقدان الكمية المدرك للنتيجة</h3><p>
  <span class="img-wrapper">
    <img translate="no" src="https://assets.zilliz.com/text_765e538864.png" alt="" class="doc-image" id="" />
    <span></span>
  </span>
</p>
<p>
  <span class="img-wrapper">
    <img translate="no" src="https://assets.zilliz.com/score_aware_quantization_loss_d9d36223c2.png" alt="" class="doc-image" id="" />
    <span></span>
  </span>
</p>
<p>
  <span class="img-wrapper">
    <img translate="no" src="https://assets.zilliz.com/text2_dd95418ba9.png" alt="" class="doc-image" id="" />
    <span></span>
  </span>
</p>
<p>
  <span class="img-wrapper">
    <img translate="no" src="https://assets.zilliz.com/quantizer_f0e39762a4.png" alt="" class="doc-image" id="" />
    <span></span>
  </span>
</p>
<p>نظرًا لأن التحليل يعتمد على مقياس IP، بعد أن تقوم ScaNN بتحليل خطأ التكميم إلى مكونات متوازية ومتعامدة، فإن المكون المتوازي فقط يؤثر على النتيجة، لذلك يجب تطبيق حد جزائي أكبر. وبالتالي، يمكن إعادة كتابة دالة الخسارة على النحو التالي:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">ℓ</mi><mrow><mo fence="true">(</mo><msub><mi>xi</mi></msub><mo separator="true">,</mo><msub><mi>x~i</mi></msub><mo separator="true">,</mo><msub><mover accent="true"><mi>x~i</mi></mover></msub><mo separator="true">,</mo><mi>w</mi><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr></mtable></semantics></math></span></span></span><mrow></mrow><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo> </mo><msub><mi>=</mi></msub></mrow></mstyle></mtd></mtr></mtable><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow><mo fence="true"> ∥(</mo><mi>w</mi><mrow><mo fence="true">,</mo></mrow></mrow><msup><mrow><mo fence="true">∥xi∥)</mo><msub><mi>∥r</mi></msub><mrow><mo fence="true">∥(</mo><msub><mi>xi</mi></msub><mo separator="true">,</mo><msub><mi>x~i</mi></msub></mrow><mo fence="true">)</mo></mrow></msup><msub><mi>∥2+h</mi></msub><mrow><mo fence="true">∥(</mo><mi>w</mi><mrow><mo fence="true">,</mo></mrow></mrow><msup><mrow><mo fence="true">∥xi∥)</mo><msub><mi>∥r</mi></msub><mrow><mo fence="true">(</mo><msub><mi>xi</mi></msub><mo separator="true">,</mo><msub><mi>x~i</mi></msub><mo fence="true">)</mo></mrow><mo fence="true">∥2 ∥2 \</mo></mrow></msup></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex"> بداية{محاذاة} \ll\left(x_i, \tilde{x}_i, w\right) &amp;=h_{\|}\left(w,\left\|x_i\right\|\right)\left\|r_{\|}\left(x_i, \tilde{x}_i\right)\right\|^2 +h_{\perp}\left(w,\left\|x_i\right\|\right)\left\|r_{\perp}\left(x_i,</annotation></semantics></math></span> \tilde{e{x}_i_right<span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><annotation encoding="application/x-tex">)\right\\^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="mord"><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist-s">\^2</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><annotation encoding="application/x-tex">\نهاية</annotation></semantics></math></span></span></span><span class="strut" style="height:1.714em;vertical-align:-0.607em;"></span><span class="katex-display"><span class="katex"></span></span><span class="pstrut" style="height:3.054em;"></span> <span class="katex-display"><span class="katex"> <span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"> </span><span class="mord"><span class="mord mathnormal">(س</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="pstrut" style="height:2.7em;"></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="mord"><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist-s">ط</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="mpunct"> ،</span><span class="mspace" style="margin-right:0.1667em;"></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="pstrut" style="height:3em;"></span> <span class="katex-display"><span class="katex"> س</span></span><span class="pstrut" style="height:3em;"></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-3.35em;"><span class="accent-body" style="left:-0.2222em;"><span class="mord"> </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> ~</span></span><span class="pstrut" style="height:2.7em;"></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="mord"><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist-s">ط</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="mpunct"> ،</span><span class="mspace" style="margin-right:0.1667em;"></span></span></span></span></span></span></span></span></span></span></span></span> ث<span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist-s">)</span></span></span></span></span></span></span></span></span></span><span class="vlist-r"><span class="vlist" style="height:0.607em;"><span></span></span></span><span class="katex-display"><span class="katex"></span></span><span class="pstrut" style="height:3.054em;"></span> <span class="katex-display"><span class="katex"></span></span><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span> <span class="katex-display"><span class="katex"> =</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="katex-display"><span class="katex">ح</span></span><span class="pstrut" style="height:2.7em;"></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"> </span></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;"> </span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span> <span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="mord mathnormal" style="margin-right:0.02691em;">(ث</span><span class="mpunct">,</span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="pstrut" style="height:2.7em;"></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span><span class="pstrut" style="height:3em;"></span><span class="pstrut" style="height:2.7em;"></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span><span class="pstrut" style="height:2.7em;"></span>∥<span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist-s"> </span><span class="vlist" style="height:0.85em;"><span style="top:-2.85em;"><span class="pstrut" style="height:3.2em;"></span><span style="width:0.556em;height:1.200em;"><svg translate="no" xmlns="http://www.w3.org/2000/svg" width="0.556em" height="1.200em" viewBox="0 0 556 1200"><path d="M145 15 v585 v0 v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v0 v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v0 v585 h43z
M367 15 v585 v0 v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v0 v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M410 15 H367 v585 v0 v585 h43z"/></svg></span></span></span><span class="vlist-s"> </span></span></span></span></span></span></span></span></span></span> <span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="minner"></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;"> </span></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="minner"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">ص</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="pstrut" style="height:2.7em;"></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="minner"><span class="mord"><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:-0.0278em;margin-right:0.05em;"><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"> </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"> </span></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span> <span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="minner"><span class="minner"><span class="mord"><span class="mord mathnormal">(س</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="pstrut" style="height:2.7em;"></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="minner"><span class="minner"><span class="mord"><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist-s">ط</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="minner"><span class="minner"><span class="mpunct"> ،</span><span class="mspace" style="margin-right:0.1667em;"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="pstrut" style="height:3em;"></span> <span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r">س</span></span></span></span></span></span></span></span></span><span class="pstrut" style="height:3em;"></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r">~</span></span></span></span></span></span></span></span></span><span class="pstrut" style="height:2.7em;"></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="minner"><span class="minner"><span class="mord"><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist-s">ط</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r">)</span></span></span></span></span></span></span></span></span><span class="vlist" style="height:0.85em;"><span style="top:-2.85em;"><span class="pstrut" style="height:3.2em;"></span><span style="width:0.556em;height:1.200em;"><svg translate="no" xmlns="http://www.w3.org/2000/svg" width="0.556em" height="1.200em" viewBox="0 0 556 1200"><path d="M145 15 v585 v0 v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v0 v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v0 v585 h43z
M367 15 v585 v0 v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v0 v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M410 15 H367 v585 v0 v585 h43z"/></svg></span></span></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="minner"><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist-s"></span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span> <span class="vlist-r"><span class="vlist-s"> </span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.054em;"><span style="top:-3.3029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"> </span></span></span></span></span></span></span></span></span></span></span> 2 <span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin"> </span></span></span></span> +</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r">ح <span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="mord"><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mrel mtight">  </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"> </span></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span> <span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"> <span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="mord mathnormal" style="margin-right:0.02691em;">(</span><span class="mpunct">ث،</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mord"><span class="mord mathnormal">س</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="pstrut" style="height:2.7em;"></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="minner"><span class="mord"><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist-s">ط</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="mclose delimcenter" style="top:0em;"> )</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"> </span><span class="mord"><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mrel mtight"> </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"> </span></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="minner"><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"> </span><span class="mord"><span class="mord mathnormal">(س</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="pstrut" style="height:2.7em;"></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="minner"><span class="minner"><span class="mord"><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist-s">ط</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.107em;"><span style="top:-3.107em;"><span class="mord"><span class="minner"><span class="minner"><span class="minner"><span class="mpunct"> ،</span><span class="mspace" style="margin-right:0.1667em;"></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="pstrut" style="height:3em;"></span><span class="vlist-s"> </span><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist-s"> </span></span><span class="vlist-r"><span class="vlist" style="height:0.607em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>يوضح الشكل أدناه مثالًا ثنائي الأبعاد يوضح أن الخطأ الناجم عن المكون المتوازي أكبر ويمكن أن يؤدي إلى نتائج غير صحيحة لأقرب جار، مما يبرر فرض عقوبة أشد.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/quantization_cp_81e23dd1df.png" alt="The left figure shows poor quantization because the parallel offset affects the final result, while the right figure shows better quantization." class="doc-image" id="the-left-figure-shows-poor-quantization-because-the-parallel-offset-affects-the-final-result,-while-the-right-figure-shows-better-quantization." />
   </span> <span class="img-wrapper"> <span>يُظهر الشكل الأيسر قياسًا كميًا ضعيفًا لأن الإزاحة المتوازية تؤثر على النتيجة النهائية، بينما يُظهر الشكل الأيمن قياسًا كميًا أفضل.</span> </span></p>
<h3 id="4-bit-PQ-FastScan" class="common-anchor-header">4 بت PQ FastScan 4 بت</h3><p>دعونا أولاً نستعرض عملية حساب PQ: أثناء الاستعلام، يتم حساب المسافات بين الاستعلام ومراكز مجموعات المتجهات الفرعية مسبقًا لإنشاء جدول بحث. يتم بعد ذلك إجراء حساب المسافات من خلال عمليات البحث في الجدول للحصول على مسافات المقطع وجمعها.</p>
<p>
  <span class="img-wrapper">
    <img translate="no" src="https://assets.zilliz.com/PQ_Fast_Scan1_248c53bc93.png" alt="" class="doc-image" id="" />
    <span></span>
  </span>
</p>
<p>ومع ذلك، لا تزال القراءات المتكررة للذاكرة تشكل عنق زجاجة في الأداء. إذا كان من الممكن جعل جدول البحث صغيرًا بما يكفي ليتناسب مع السجلات، فيمكن تحويل عمليات قراءة الذاكرة إلى تعليمات SIMD فعالة لوحدة المعالجة المركزية.</p>
<p>أولًا، يتم تجميع كل متجه فرعي في 16 فئة، بحيث يمكن أن تمثل قيمة 4 بت مركزًا للمجموعة - وهذا هو أصل اسم "PQ 4 بت". بعد ذلك، يتم تحويل المسافات التي يتم تمثيلها عادةً على هيئة عوامات إلى uint8 باستخدام التكميم الكمي Scalar Quantization (SQ). بهذه الطريقة، يمكن تخزين جدول البحث لمتجه فرعي واحد في سجل باستخدام 16 × 8 = 128 بت.</p>
<p>
  <span class="img-wrapper">
    <img translate="no" src="https://assets.zilliz.com/PQ_Fast_Scan2_07b9589195.png" alt="" class="doc-image" id="" />
    <span></span>
  </span>
</p>
<p>أخيرًا، دعونا نفحص تخطيط تخزين السجل (باستخدام مجموعة تعليمات AVX2 كمثال): يتم وضع المتجهات الفرعية لـ 32 متجهًا في سجل 128 بت، مع جدول البحث. يمكن بعد ذلك إكمال عملية "البحث" بكفاءة باستخدام تعليمات وحدة المعالجة المركزية SIMD خلط SIMD واحدة.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/register_layout_b2bf8c2b2b.png" alt="register layout" class="doc-image" id="register-layout" />
   </span> <span class="img-wrapper"> <span>تخطيط السجل</span> </span></p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/SIMD_Shuffle_for_Lookup_c86e6d9657.png" alt="SIMD Shuffle for Lookup" class="doc-image" id="simd-shuffle-for-lookup" />
   </span> <span class="img-wrapper"> <span>خلط SIMD Shuffle للبحث</span> </span></p>
<p>إليكم ملاحظة مثيرة للاهتمام: تركز ورقة ScaNN الورقية بالكامل على التحسين الأول، وهو أمر معقول حيث يمكن اعتبارها ورقة خوارزمية تركز على الاشتقاقات الرياضية. ومع ذلك، فإن النتائج التجريبية المقدمة في الورقة البحثية مثيرة للإعجاب بشكل ملحوظ.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/experimental_results_a46ec830a7.png" alt="The experimental results presented in the ScaNN paper." class="doc-image" id="the-experimental-results-presented-in-the-scann-paper." />
   </span> <span class="img-wrapper"> <span>النتائج التجريبية المقدمة في ورقة ScaNN</span>. </span></p>
<p>من البديهي أن تحسين الخسارة وحدها لا ينبغي أن ينتج عنه مثل هذه التأثيرات المثيرة. وقد أشارت <a href="https://medium.com/@kumon/similarity-search-scann-and-4-bit-pq-fastscan-ab98766b32bd">مدونة</a> أخرى إلى ذلك أيضًا - ما يصنع الفرق حقًا هو جزء PQ FastScan المكون من 4 بت.</p>
<h2 id="Experimental-Results" class="common-anchor-header">النتائج التجريبية<button data-href="#Experimental-Results" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>باستخدام أداة قياس قاعدة البيانات المتجهة <a href="https://github.com/zilliztech/VectorDBBench">VectorDBBench،</a> أجرينا اختبارًا بسيطًا. كانت ميزة أداء ScaNN على أداء IVFFLAT و IVF_PQ التقليدي واضحة تمامًا. بعد الدمج في Milvus، على مجموعة بيانات Cohere1M بنفس معدل الاسترجاع، يمكن أن تصل QPS إلى 5 أضعاف أداء IVFFLAT و6 أضعاف أداء IVF_PQ.</p>
<p>ومع ذلك، فإن QPS أقل بقليل من الفهارس القائمة على الرسم البياني مثل HNSW، لذا فهو ليس الخيار الأول لحالات الاستخدام ذات معدل الاستدعاء العالي. ولكن بالنسبة للسيناريوهات ذات الاستدعاء المنخفض، فإنه مقبول (كما هو الحال في بعض أنظمة التوصية)، يمكن أن يحقق استخدام ScaNN دون تحميل البيانات الأولية QPS مذهلًا مع بصمة ذاكرة منخفضة للغاية (1/16 من البيانات الأصلية)، مما يجعله خيارًا ممتازًا للفهرس.</p>
<table>
<thead>
<tr><th>نوع_الفهرس</th><th>الحالة</th><th>QPS</th><th>زمن الوصول (p99)</th><th>الاستدعاء</th><th>الذاكرة</th></tr>
</thead>
<tbody>
<tr><td>IVFFLAT</td><td>الأداء1م</td><td>266</td><td>0.0173s</td><td>0.9544</td><td>3G</td></tr>
<tr><td>HNSW</td><td>الأداء1م</td><td>1885</td><td>0.0054s</td><td>0.9438</td><td>3.24G</td></tr>
<tr><td>IVF_PQ</td><td>الأداء1م</td><td>208</td><td>0.0292s</td><td>0.928</td><td>0.375G</td></tr>
<tr><td>ScaNN （مع_البيانات_الخام: صحيح）</td><td>الأداء1م</td><td>1215</td><td>0.0069s</td><td>0.9389</td><td>3.186G</td></tr>
<tr><td>ScaNN （مع_البيانات_الأولية: خطأ）</td><td>الأداء1م</td><td>1265</td><td>0.0071s</td><td>0.7066</td><td>0.186G</td></tr>
</tbody>
</table>
<h2 id="Conclusion" class="common-anchor-header">الخلاصة<button data-href="#Conclusion" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>يعتمد ScaNN على إطار عمل IVFPPQ المألوف ولكنه يدفعه إلى أبعد من ذلك بكثير من خلال العمل الهندسي العميق في كل من التكميم وتسريع البحث منخفض المستوى. من خلال مواءمة هدف التكميم مع جودة الترتيب والتخلص من اختناقات الذاكرة في الحلقة الداخلية، تجمع ScaNN بين التكميم الواعي بالدرجات ومسار PQ FastScan رباعي البتات الذي يحول عملية تقليدية مرتبطة بالذاكرة إلى عملية حسابية فعالة وملائمة ل SIMD.</p>
<p>في الممارسة العملية، يمنح هذا ScaNN مكانة واضحة ومحددة جيدًا. ليس المقصود منه أن يحل محل الفهارس القائمة على الرسم البياني مثل HNSW في الإعدادات عالية الاستدعاء. بدلاً من ذلك، بالنسبة لأحمال العمل غير الحساسة للاستدعاء ذات ميزانيات الذاكرة الضيقة، توفر ScaNN إنتاجية عالية مع بصمة صغيرة جدًا. في تجاربنا، بعد الاندماج في Milvus VectorDB، حققت ScaNN ما يقرب من 5 أضعاف QPS من IVFFLAT على مجموعة بيانات Cohere1M، مما يجعلها خيارًا قويًا لاسترجاع الشبكة النانوية ذات الإنتاجية العالية والكمون المنخفض حيث يكون الضغط والكفاءة أكثر أهمية من الاسترجاع المثالي.</p>
<p>إذا كنت مهتمًا باستكشاف ScaNN بشكل أكبر أو مناقشة اختيار الفهرس في أنظمة العالم الحقيقي، انضم إلى <a href="https://milvusio.slack.com/join/shared_invite/zt-3nntzngkz-gYwhrdSE4~76k0VMyBfD1Q#/shared-invite/email">قناة Slack Channel</a> الخاصة بنا للدردشة مع مهندسينا ومهندسي الذكاء الاصطناعي الآخرين في المجتمع. يمكنك أيضًا حجز جلسة فردية مدتها 20 دقيقة للحصول على رؤى وإرشادات وإجابات على أسئلتك من خلال <a href="https://milvus.io/blog/join-milvus-office-hours-to-get-support-from-vectordb-experts.md">ساعات عمل Milvus المكتبية</a>.</p>
