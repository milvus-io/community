---
id: understanding-consistency-levels-in-the-milvus-vector-database.md
title: Понимание уровня согласованности в базе данных Milvus Vector
author: Chenglong Li
date: 2022-08-29T00:00:00.000Z
desc: >-
  Узнайте о четырех уровнях согласованности - сильном, ограниченном, сессионном
  и конечном, которые поддерживаются в векторной базе данных Milvus.
cover: assets.zilliz.com/1280_X1280_0e0d4bc107.png
tag: Engineering
tags: 'Vector Database for AI, Artificial Intelligence, Machine Learning'
canonicalUrl: >-
  https://milvus.io/blog/understanding-consistency-levels-in-the-milvus-vector-database.md
---
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/1280_X1280_0e0d4bc107.png" alt="Cover_image" class="doc-image" id="cover_image" />
   </span> <span class="img-wrapper"> <span>Cover_image</span> </span></p>
<blockquote>
<p>Эта статья написана <a href="https://github.com/JackLCL">Ченглонг Ли (Chenglong Li</a> ) и переработана <a href="https://www.linkedin.com/in/yiyun-n-2aa713163/">Анжелой Ни (Angela Ni</a>).</p>
</blockquote>
<p>Вы когда-нибудь задумывались, почему иногда данные, которые вы удалили из векторной базы данных Mlivus, все равно появляются в результатах поиска?</p>
<p>Вполне вероятно, что причина в том, что вы не установили соответствующий уровень согласованности для своего приложения. Уровень согласованности в распределенной векторной базе данных очень важен, поскольку он определяет, в какой момент определенная запись данных может быть прочитана системой.</p>
<p>Поэтому в этой статье мы постараемся раскрыть концепцию согласованности и рассмотреть уровни согласованности, поддерживаемые векторной базой данных Milvus.</p>
<p><strong>Перейти к разделу:</strong></p>
<ul>
<li><a href="#What-is-consistency">Что такое согласованность</a></li>
<li><a href="#Four-levels-of-consistency-in-the-Milvus-vector-database">Четыре уровня согласованности в векторной базе данных Milvus</a><ul>
<li><a href="#Strong">Сильная</a></li>
<li><a href="#Bounded-staleness">Ограниченная неизменность</a></li>
<li><a href="#Session">Сессия</a></li>
<li><a href="#Eventual">Эвентуальная</a></li>
</ul></li>
</ul>
<h2 id="What-is-consistency" class="common-anchor-header">Что такое согласованность<button data-href="#What-is-consistency" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>Прежде чем начать, нам необходимо прояснить значение термина "согласованность" в этой статье, поскольку слово "согласованность" является перегруженным термином в компьютерной индустрии. Под согласованностью в распределенной базе данных понимается свойство, которое обеспечивает одинаковое представление данных на каждом узле или реплике при записи или чтении данных в определенный момент времени. Таким образом, здесь мы говорим о согласованности, как в <a href="https://en.wikipedia.org/wiki/CAP_theorem">теореме CAP</a>.</p>
<p>В современном мире для обслуживания крупных онлайн-компаний обычно используется несколько реплик. Например, гигант электронной коммерции Amazon реплицирует данные о своих заказах или SKU в нескольких центрах обработки данных, зонах или даже странах, чтобы обеспечить высокую доступность системы в случае сбоя или отказа. Это ставит перед системой непростую задачу - согласованность данных в нескольких репликах. Без согласованности данных велика вероятность того, что удаленный товар в корзине Amazon появится снова, что вызовет неприятные ощущения у пользователей.</p>
<p>Следовательно, для разных приложений нужны разные уровни согласованности данных. К счастью, Milvus, база данных для искусственного интеллекта, предлагает гибкий уровень согласованности, и вы можете установить тот уровень согласованности, который лучше всего подходит для вашего приложения.</p>
<h3 id="Consistency-in-the-Milvus-vector-database" class="common-anchor-header">Согласованность в векторной базе данных Milvus</h3><p>Концепция уровня согласованности была впервые введена с выходом Milvus 2.0. Версия Milvus 1.0 не была распределенной векторной базой данных, поэтому тогда мы не использовали настраиваемые уровни согласованности. Milvus 1.0 обновляет данные каждую секунду, что означает, что новые данные становятся видны практически сразу после их вставки, и Milvus считывает наиболее обновленное представление данных именно в тот момент, когда поступает запрос на поиск или запрос векторного сходства.</p>
<p>Однако в версии 2.0 Milvus был подвергнут рефакторингу, и <a href="https://milvus.io/blog/deep-dive-1-milvus-architecture-overview.md">Milvus 2.0 представляет собой распределенную векторную базу данных</a>, основанную на механизме pub-sub. Теорема <a href="https://en.wikipedia.org/wiki/PACELC_theorem">PACELC</a> указывает на то, что распределенная система должна находить компромисс между согласованностью, доступностью и задержкой. Кроме того, различные уровни согласованности служат для различных сценариев. Поэтому в <a href="https://milvus.io/blog/2022-1-25-annoucing-general-availability-of-milvus-2-0.md">Milvus 2.0</a> была введена концепция согласованности, которая поддерживает настройку уровней согласованности.</p>
<h2 id="Four-levels-of-consistency-in-the-Milvus-vector-database" class="common-anchor-header">Четыре уровня согласованности в векторной базе данных Milvus<button data-href="#Four-levels-of-consistency-in-the-Milvus-vector-database" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>Milvus поддерживает четыре уровня согласованности: сильную, ограниченную, сессионную и временную. Пользователь Milvus может указать уровень согласованности при <a href="https://milvus.io/docs/v2.1.x/create_collection.md">создании коллекции</a> или выполнении <a href="https://milvus.io/docs/v2.1.x/search.md">поиска</a> или <a href="https://milvus.io/docs/v2.1.x/query.md">запроса</a> <a href="https://milvus.io/docs/v2.1.x/search.md">векторного сходства</a>. В этом разделе мы продолжим объяснять, чем отличаются эти четыре уровня согласованности и для какого сценария они лучше всего подходят.</p>
<h3 id="Strong" class="common-anchor-header">Strong</h3><p>Strong - это самый высокий и самый строгий уровень согласованности. Он гарантирует, что пользователи смогут прочитать самую последнюю версию данных.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/Consistency_Strong_5d791eb8b2.png" alt="Strong" class="doc-image" id="strong" />
   </span> <span class="img-wrapper"> <span>Strong</span> </span></p>
<p>Согласно теореме PACELC, если уровень согласованности установлен на сильный, то задержка увеличится. Поэтому мы рекомендуем выбирать сильную согласованность при функциональном тестировании, чтобы обеспечить точность результатов тестирования. Кроме того, сильная согласованность лучше всего подходит для приложений, в которых предъявляются жесткие требования к согласованности данных ценой снижения скорости поиска. Примером может служить финансовая онлайн-система, работающая с оплатой заказов и выставлением счетов.</p>
<h3 id="Bounded-staleness" class="common-anchor-header">Ограниченная неизменность</h3><p>Ограниченная неизменность, как следует из названия, допускает непоследовательность данных в течение определенного периода времени. Однако, как правило, данные всегда глобально согласованы вне этого периода времени.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/Consistency_Bounded_c034bc6e51.png" alt="Bounded_staleness" class="doc-image" id="bounded_staleness" />
   </span> <span class="img-wrapper"> <span>Ограниченная_стабильность</span> </span></p>
<p>Ограниченная неизменность подходит для сценариев, в которых необходимо контролировать задержку поиска и допускать спорадическую невидимость данных. Например, в рекомендательных системах, таких как системы рекомендаций видео, невидимость данных время от времени оказывает действительно небольшое влияние на общий коэффициент отзыва, но может значительно повысить производительность рекомендательной системы. Примером может служить приложение для отслеживания статуса ваших онлайн-заказов.</p>
<h3 id="Session" class="common-anchor-header">Сессия</h3><p>Сессия гарантирует, что все записанные данные могут быть немедленно восприняты при чтении в течение той же сессии. Другими словами, когда вы записываете данные через один клиент, вновь вставленные данные мгновенно становятся доступными для поиска.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/Consistency_Session_6dc4782212.png" alt="Session" class="doc-image" id="session" />
   </span> <span class="img-wrapper"> <span>Сессия</span> </span></p>
<p>Мы рекомендуем выбирать сеанс в качестве уровня согласованности для тех сценариев, где высока потребность в согласованности данных в одной и той же сессии. Примером может служить удаление данных о записи в книге из библиотечной системы, причем после подтверждения удаления и обновления страницы (в другой сессии) книга больше не должна отображаться в результатах поиска.</p>
<h3 id="Eventual" class="common-anchor-header">В конечном итоге</h3><p>Порядок чтения и записи не гарантируется, и реплики в конечном итоге сходятся к одному и тому же состоянию, если больше не выполнять никаких операций записи. При эвентуальной согласованности реплики начинают работать с запросами на чтение с последними обновленными значениями. Эвентуальная согласованность - самый слабый уровень из четырех.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/Consistency_Eventual_7c66dd5b6f.png" alt="Eventual" class="doc-image" id="eventual" />
   </span> <span class="img-wrapper"> <span>Eventual</span> </span></p>
<p>Однако, согласно теореме PACELC, задержка поиска может быть значительно сокращена, если пожертвовать согласованностью. Поэтому эвентуальная согласованность лучше всего подходит для сценариев, в которых нет высоких требований к согласованности данных, но требуется молниеносная производительность поиска. В качестве примера можно привести поиск отзывов и оценок товаров на Amazon с использованием эвентуальной согласованности.</p>
<h2 id="Endnote" class="common-anchor-header">Конечная сноска<button data-href="#Endnote" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>Итак, возвращаясь к вопросу, поднятому в начале статьи, можно сказать, что удаленные данные все еще возвращаются в результатах поиска, потому что пользователь не выбрал нужный уровень согласованности. По умолчанию для уровня согласованности в векторной базе данных Milvus используется значение bounded staleness (<code translate="no">Bounded</code>). Поэтому чтение данных может запаздывать, и Milvus может считать данные до того, как вы выполнили операции удаления во время поиска или запроса по сходству. Однако эту проблему легко решить. Все, что вам нужно сделать, - это <a href="https://milvus.io/docs/v2.1.x/tune_consistency.md">настроить уровень согласованности</a> при создании коллекции или выполнении поиска или запроса векторного сходства. Просто!</p>
<p>В следующем посте мы раскроем механизм и объясним, как в векторной базе данных Milvus достигаются различные уровни согласованности. Оставайтесь с нами!</p>
<h2 id="Whats-next" class="common-anchor-header">Что дальше<button data-href="#Whats-next" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>После официального выхода Milvus 2.1 мы подготовили серию блогов, в которых рассказываем о новых возможностях. Читайте подробнее в этой серии блогов:</p>
<ul>
<li><a href="https://milvus.io/blog/2022-08-08-How-to-use-string-data-to-empower-your-similarity-search-applications.md">Как использовать строковые данные для расширения возможностей приложений поиска по сходству</a></li>
<li><a href="https://milvus.io/blog/embedded-milvus.md">Использование Embedded Milvus для мгновенной установки и запуска Milvus с Python</a></li>
<li><a href="https://milvus.io/blog/in-memory-replicas.md">Увеличение пропускной способности базы данных Vector с помощью реплик в памяти</a></li>
<li><a href="https://milvus.io/blog/understanding-consistency-levels-in-the-milvus-vector-database.md">Понимание уровня согласованности в векторной базе данных Milvus</a></li>
<li><a href="https://milvus.io/blog/understanding-consistency-levels-in-the-milvus-vector-database-2.md">Понимание уровня согласованности в векторной базе данных Milvus (часть II)</a></li>
<li><a href="https://milvus.io/blog/data-security.md">Как база данных Milvus Vector обеспечивает безопасность данных?</a></li>
</ul>
