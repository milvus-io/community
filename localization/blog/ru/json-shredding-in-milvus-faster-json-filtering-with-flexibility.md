---
id: json-shredding-in-milvus-faster-json-filtering-with-flexibility.md
title: 'Измельчение JSON в Milvus: 88,9-кратное ускорение фильтрации JSON с гибкостью'
author: Jack Zhang
date: 2025-12-04T00:00:00.000Z
cover: assets.zilliz.com/JSON_Shredding_new_Cover_1_f9253063f5.png
tag: Engineering
recommend: false
publishToMedium: true
tags: 'Milvus, vector database'
meta_keywords: 'Milvus, JSON Shredding, JSON performance, columnar storage'
meta_title: |
  Milvus JSON Shredding: Faster JSON Filtering With Flexibility
desc: >-
  Узнайте, как Milvus JSON Shredding использует оптимизированное столбцовое
  хранилище для ускорения запросов JSON до 89× при сохранении полной гибкости
  схемы.
origin: >-
  https://milvus.io/blog/json-shredding-in-milvus-faster-json-filtering-with-flexibility.md
---
<p>Современные системы искусственного интеллекта производят больше полуструктурированных данных в формате JSON, чем когда-либо прежде. Информация о клиентах и продуктах сжимается до объекта JSON, микросервисы выдают журналы JSON при каждом запросе, IoT-устройства передают показания датчиков в виде легких полезных нагрузок JSON, а современные приложения ИИ все чаще стандартизируют JSON для структурированного вывода. В результате в векторные базы данных стекается поток JSON-подобных данных.</p>
<p>Традиционно существует два способа работы с документами JSON:</p>
<ul>
<li><p><strong>Предопределить каждое поле JSON в фиксированной схеме и создать индекс:</strong> Этот подход обеспечивает высокую производительность запросов, но он негибок. При изменении формата данных каждое новое или модифицированное поле вызывает очередной раунд болезненных обновлений языка определения данных (DDL) и миграций схемы.</p></li>
<li><p><strong>Хранить весь объект JSON в виде одного столбца (такой подход используется и в типе JSON, и в динамической схеме Milvus):</strong> Этот вариант обеспечивает отличную гибкость, но ценой снижения производительности запросов. Каждый запрос требует разбора JSON во время выполнения и часто полного сканирования таблицы, что приводит к задержкам, которые увеличиваются по мере роста набора данных.</p></li>
</ul>
<p>Раньше это была дилемма гибкости и производительности.</p>
<p>Теперь это не так, благодаря недавно появившейся в <a href="https://milvus.io/">Milvus</a> функции JSON Shredding.</p>
<p>С внедрением <a href="https://milvus.io/docs/json-shredding.md">JSON Shredding</a> Milvus теперь обеспечивает гибкость без схем и производительность колоночного хранилища, наконец-то делая крупномасштабные полуструктурированные данные гибкими и удобными для запросов.</p>
<h2 id="How-JSON-Shredding-Works" class="common-anchor-header">Принцип работы JSON Shredding<button data-href="#How-JSON-Shredding-Works" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>Измельчение JSON ускоряет запросы JSON за счет преобразования документов JSON, основанных на строках, в высоко оптимизированное столбцовое хранилище. Milvus сохраняет гибкость JSON для моделирования данных, при этом автоматически оптимизируя столбцовое хранение, что значительно повышает доступ к данным и производительность запросов.</p>
<p>Для эффективной работы с разреженными или редкими полями JSON в Milvus также предусмотрен инвертированный индекс для общих ключей. Все это происходит прозрачно для пользователей: вы можете вставлять JSON-документы, как обычно, и предоставить Milvus самому управлять оптимальной стратегией хранения и индексирования.</p>
<p>Когда Milvus получает необработанные записи JSON с различными формами и структурами, он анализирует каждый ключ JSON на предмет коэффициента встречаемости и стабильности типа (является ли тип данных постоянным в разных документах). На основе этого анализа каждый ключ классифицируется в одну из трех категорий:</p>
<ul>
<li><p><strong>Типовые ключи:</strong> Ключи, которые встречаются в большинстве документов и всегда имеют один и тот же тип данных (например, все целые числа или все строки).</p></li>
<li><p><strong>Динамические ключи</strong>: Ключи, которые появляются часто, но имеют смешанные типы данных (например, иногда строка, иногда целое число).</p></li>
<li><p><strong>Общие ключи:</strong> Ключи, которые появляются нечасто, редко или вложенно, и их частота ниже настраиваемого порога.</p></li>
</ul>
<p>Milvus обрабатывает каждую категорию по-разному, чтобы добиться максимальной эффективности:</p>
<ul>
<li><p><strong>Типизированные ключи</strong> хранятся в специальных столбцах с сильной типизацией.</p></li>
<li><p><strong>Динамические ключи</strong> помещаются в динамические колонки на основе фактического типа значения, наблюдаемого во время выполнения.</p></li>
<li><p>Как типизированные, так и динамические столбцы хранятся в формате Arrow/Parquet columnar для быстрого сканирования и оптимизации выполнения запросов.</p></li>
<li><p><strong>Общие ключи</strong> объединяются в компактный двоичный-JSON-столбец, сопровождаемый инвертированным индексом общих ключей. Этот индекс ускоряет выполнение запросов по низкочастотным полям, отсекая нерелевантные строки и ограничивая поиск только теми документами, которые содержат запрашиваемый ключ.</p></li>
</ul>
<p>Эта комбинация адаптивного столбчатого хранилища и инвертированного индекса составляет основу механизма измельчения JSON в Milvus, обеспечивая гибкость и высокую производительность в масштабе.</p>
<p>Общая схема работы показана ниже:</p>
<p>
  <span class="img-wrapper">
    <img translate="no" src="https://assets.zilliz.com/json_shredding_79a62a9661.PNG" alt="" class="doc-image" id="" />
    <span></span>
  </span>
</p>
<p>Теперь, когда мы рассмотрели основные принципы работы JSON Shredding, давайте подробнее рассмотрим ключевые возможности, которые делают этот подход гибким и высокопроизводительным.</p>
<h3 id="Shredding-and-Columnarization" class="common-anchor-header">Измельчение и колонкаризация</h3><p>Когда записывается новый JSON-документ, Milvus разбивает его на части и реорганизует в оптимизированное колоночное хранилище:</p>
<ul>
<li><p>Типизированные и динамические ключи автоматически идентифицируются и хранятся в специальных колонках.</p></li>
<li><p>Если JSON содержит вложенные объекты, Milvus автоматически генерирует имена колонок на основе путей. Например, поле <code translate="no">name</code> внутри объекта <code translate="no">user</code> может храниться с именем колонки <code translate="no">/user/name</code>.</p></li>
<li><p>Общие ключи хранятся вместе в одном компактном двоичном столбце JSON. Поскольку такие ключи встречаются нечасто, Milvus строит для них инвертированный индекс, обеспечивающий быструю фильтрацию и позволяющий системе быстро находить строки, содержащие указанный ключ.</p></li>
</ul>
<h3 id="Intelligent-Column-Management" class="common-anchor-header">Интеллектуальное управление столбцами</h3><p>Помимо измельчения JSON в столбцы, Milvus добавляет дополнительный уровень интеллекта за счет динамического управления столбцами, обеспечивая гибкость JSON Shredding по мере изменения данных.</p>
<ul>
<li><p><strong>Колонки создаются по мере необходимости:</strong> Когда во входящих документах JSON появляются новые ключи, Milvus автоматически группирует значения с одним и тем же ключом в специальный столбец. Это позволяет сохранить преимущества столбцового хранения в плане производительности, не требуя от пользователей предварительной разработки схем. Milvus также определяет тип данных новых полей (например, INTEGER, DOUBLE, VARCHAR) и выбирает для них эффективный столбцовый формат.</p></li>
<li><p><strong>Каждый ключ обрабатывается автоматически:</strong> Milvus анализирует и обрабатывает каждый ключ в документе JSON. Это обеспечивает широкое покрытие запросов, не заставляя пользователей заранее определять поля или создавать индексы.</p></li>
</ul>
<h3 id="Query-Optimization" class="common-anchor-header">Оптимизация запросов</h3><p>После реорганизации данных в нужные колонки Milvus выбирает наиболее эффективный путь выполнения для каждого запроса:</p>
<ul>
<li><p><strong>Прямое сканирование столбцов для типизированных и динамических ключей:</strong> Если запрос нацелен на поле, которое уже разделено на отдельный столбец, Milvus может сканировать этот столбец напрямую. Это позволяет сократить общий объем данных, которые необходимо обработать, и использовать ускоренные SIMD-вычисления по столбцам для еще более быстрого выполнения.</p></li>
<li><p><strong>Индексированный поиск для общих ключей:</strong> Если в запросе используется поле, которое не было вынесено в отдельный столбец - как правило, это редкий ключ, - Milvus оценивает его по столбцу с общим ключом. Инвертированный индекс, построенный по этому столбцу, позволяет Milvus быстро определить, какие строки содержат указанный ключ, и пропустить остальные, что значительно повышает производительность для полей с низкой частотой встречаемости.</p></li>
<li><p><strong>Автоматическое управление метаданными:</strong> Milvus постоянно поддерживает глобальные метаданные и словари, чтобы запросы оставались точными и эффективными, даже если структура входящих JSON-документов изменяется с течением времени.</p></li>
</ul>
<h2 id="Performance-benchmarks" class="common-anchor-header">Контрольные показатели производительности<button data-href="#Performance-benchmarks" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>Мы разработали бенчмарк для сравнения производительности запросов при хранении всего JSON-документа в виде одного необработанного поля и при использовании недавно выпущенной функции измельчения JSON.</p>
<h3 id="Test-environment-and-methodology" class="common-anchor-header">Тестовая среда и методология</h3><ul>
<li><p>Оборудование: 1 ядро/8 ГБ кластер</p></li>
<li><p>Набор данных: 1 миллион документов из <a href="https://github.com/ClickHouse/JSONBench.git">JSONBench</a></p></li>
<li><p>Методология: Измерение QPS и задержки для различных шаблонов запросов</p></li>
</ul>
<h3 id="Results-typed-keys" class="common-anchor-header">Результаты: набранные ключи</h3><p>В этом тесте измерялась производительность при запросе ключа, присутствующего в большинстве документов.</p>
<table>
<thead>
<tr><th>Выражение запроса</th><th>QPS (без измельчения)</th><th>QPS (с измельчением)</th><th>Увеличение производительности</th></tr>
</thead>
<tbody>
<tr><td>json['time_us'] &gt; 0</td><td>8.69</td><td>287.5</td><td><strong>33x</strong></td></tr>
<tr><td>json['kind'] == 'commit'</td><td>8.42</td><td>126.1</td><td><strong>14.9x</strong></td></tr>
</tbody>
</table>
<h3 id="Results-shared-keys" class="common-anchor-header">Результаты: общие ключи</h3><p>В этом тесте мы сосредоточились на запросах к разрозненным вложенным ключам, которые относятся к категории "общие".</p>
<table>
<thead>
<tr><th>Выражение запроса</th><th>QPS (без измельчения)</th><th>QPS (с измельчением)</th><th>Увеличение производительности</th></tr>
</thead>
<tbody>
<tr><td>json['identity']['seq'] &gt; 0</td><td>4.33</td><td>385</td><td><strong>88.9x</strong></td></tr>
<tr><td>json['identity']['did'] == 'xxxxx'</td><td>7.6</td><td>352</td><td><strong>46.3x</strong></td></tr>
</tbody>
</table>
<p>Запросы с общим ключом демонстрируют самые значительные улучшения (до 89× быстрее), в то время как запросы с типизированным ключом стабильно ускоряются на 15-30×. В целом, каждый тип запросов выигрывает от использования JSON Shredding, причем явный прирост производительности наблюдается повсеместно.</p>
<h2 id="Try-It-Now" class="common-anchor-header">Попробуйте прямо сейчас<button data-href="#Try-It-Now" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>Работаете ли вы с журналами API, данными датчиков IoT или быстро меняющимися полезными нагрузками приложений, JSON Shredding дает вам редкую возможность обеспечить гибкость и высокую производительность.</p>
<p>Функция уже доступна, и мы приглашаем вас опробовать ее прямо сейчас. Вы также можете ознакомиться с <a href="https://milvus.io/docs/json-shredding.md">этим документом</a> для получения более подробной информации.</p>
<p>У вас есть вопросы или вы хотите получить подробную информацию о любой функции последней версии Milvus? Присоединяйтесь к нашему<a href="https://discord.com/invite/8uyFbECzPX"> каналу Discord</a> или создавайте проблемы на<a href="https://github.com/milvus-io/milvus"> GitHub</a>. Вы также можете записаться на 20-минутную индивидуальную сессию, чтобы получить понимание, руководство и ответы на свои вопросы в<a href="https://milvus.io/blog/join-milvus-office-hours-to-get-support-from-vectordb-experts.md"> Milvus Office Hours</a>.</p>
