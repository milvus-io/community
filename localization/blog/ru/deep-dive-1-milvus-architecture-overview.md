---
id: deep-dive-1-milvus-architecture-overview.md
title: Создание базы данных векторов для масштабируемого поиска сходства
author: Xiaofan Luan
date: 2022-03-14T00:00:00.000Z
desc: >-
  Первая статья из серии блогов, в которой мы подробно рассмотрим процесс
  создания самой популярной векторной базы данных с открытым исходным кодом и
  принципы проектирования.
cover: assets.zilliz.com/20220705_102717_dd4124dee3.png
tag: Engineering
tags: 'Data science, Database, Technology, Artificial Intelligence, Vector Management'
canonicalUrl: 'https://milvus.io/blog/deep-dive-1-milvus-architecture-overview.md'
---
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/20220705_102717_dd4124dee3.png" alt="Cover image" class="doc-image" id="cover-image" />
   </span> <span class="img-wrapper"> <span>Изображение на обложке</span> </span></p>
<blockquote>
<p>Эта статья написана Сяофань Луань и переработана Анжелой Ни и Клэр Ю.</p>
</blockquote>
<p>Согласно <a href="https://mitsloan.mit.edu/ideas-made-to-matter/tapping-power-unstructured-data">статистике</a>, около 80-90 % всех данных в мире являются неструктурированными. Благодаря стремительному росту Интернета в ближайшие годы ожидается взрывное увеличение объема неструктурированных данных. Следовательно, компании остро нуждаются в мощной базе данных, которая поможет им лучше обрабатывать и понимать такие данные. Однако разработать базу данных всегда легче сказать, чем сделать. Цель этой статьи - рассказать о процессе мышления и принципах проектирования при создании Milvus, облачной векторной базы данных с открытым исходным кодом для масштабируемого поиска по сходству. В статье также подробно описывается архитектура Milvus.</p>
<p>Перейти к:</p>
<ul>
<li><a href="#Unstructured-data-requires-a-complete-basic-software-stack">Неструктурированные данные требуют полного стека базового программного обеспечения</a><ul>
<li><a href="#Vectors-and-scalars">Векторы и скаляры</a></li>
<li><a href="#From-vector-search-engine-to-vector-database">От векторной поисковой системы к векторной базе данных</a></li>
<li><a href="#A-cloud-native-first-approach">Облачный нативный подход</a></li>
</ul></li>
<li><a href="#The-design-principles-of-Milvus-20">Принципы проектирования Milvus 2.0</a><ul>
<li><a href="#Log-as-data">Журнал как данные</a></li>
<li><a href="#Duality-of-table-and-log">Двойственность таблицы и журнала</a></li>
<li><a href="#Log-persistency">Персистентность журнала</a></li>
</ul></li>
<li><a href="#Building-a-vector-database-for-scalable-similarity-search">Построение векторной базы данных для масштабируемого поиска по сходству</a><ul>
<li><a href="#Standalone-and-cluster">Автономная и кластерная</a></li>
<li><a href="#A-bare-bones-skeleton-of-the-Milvus-architecture">Голый скелет архитектуры Milvus</a></li>
<li><a href="#Data-Model">Модель данных</a></li>
</ul></li>
</ul>
<h2 id="Unstructured-data-requires-a-complete-basic-software-stack" class="common-anchor-header">Неструктурированные данные требуют полного стека базового программного обеспечения<button data-href="#Unstructured-data-requires-a-complete-basic-software-stack" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>По мере роста и развития Интернета неструктурированные данные становились все более распространенными, включая электронные письма, документы, данные датчиков IoT, фотографии из Facebook, структуры белков и многое другое. Чтобы компьютеры могли понимать и обрабатывать неструктурированные данные, они преобразуются в векторы с помощью <a href="https://zilliz.com/learn/embedding-generation">методов встраивания</a>.</p>
<p>Milvus хранит и индексирует эти векторы, а также анализирует корреляцию между двумя векторами, вычисляя расстояние их сходства. Если два вектора встраивания очень похожи, это означает, что и исходные источники данных тоже похожи.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/Frame_1_6_5e0ab80f2c.png" alt="The workflow of processing unstructured data." class="doc-image" id="the-workflow-of-processing-unstructured-data." />
   </span> <span class="img-wrapper"> <span>Рабочий процесс обработки неструктурированных данных</span>. </span></p>
<h3 id="Vectors-and-scalars" class="common-anchor-header">Векторы и скаляры</h3><p>Скаляр - это величина, которая описывается только одним измерением - величиной. Скаляр можно представить в виде числа. Например, автомобиль движется со скоростью 80 км/ч. Здесь скорость (80 км/ч) - это скаляр. Вектор же - это величина, которая описывается как минимум двумя измерениями - величиной и направлением. Если автомобиль движется на запад со скоростью 80 км/ч, то скорость (80 км/ч на запад) - это вектор. На рисунке ниже приведен пример общих скаляров и векторов.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/Frame_1_7_90a142ab5b.png" alt="Scalars vs. Vectors" class="doc-image" id="scalars-vs.-vectors" />
   </span> <span class="img-wrapper"> <span>Скаляры против векторов</span> </span></p>
<p>Поскольку большинство важных данных имеют более одного атрибута, мы можем лучше понять эти данные, если преобразуем их в векторы. Один из распространенных способов манипулирования векторными данными - вычисление расстояния между векторами с помощью таких <a href="https://milvus.io/docs/v2.0.x/metric.md">метрик</a>, как евклидово расстояние, внутреннее произведение, расстояние Танимото, расстояние Хэмминга и т. д. Чем ближе расстояние, тем более похожи векторы. Чтобы эффективно запрашивать массивные векторные данные, мы можем упорядочить векторные данные, создав для них индексы. После того как набор данных проиндексирован, запросы можно направлять в кластеры или подмножества данных, которые с наибольшей вероятностью содержат векторы, схожие с входным запросом.</p>
<p>Чтобы узнать больше об индексах, обратитесь к разделу <a href="https://milvus.io/docs/v2.0.x/index.md">Векторный индекс</a>.</p>
<h3 id="From-vector-search-engine-to-vector-database" class="common-anchor-header">От векторной поисковой системы к векторной базе данных</h3><p>С самого начала Milvus 2.0 был задуман не только как поисковая система, но и, что более важно, как мощная база данных векторов.</p>
<p>Чтобы помочь вам понять разницу, можно провести аналогию между <a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-introduction.html">InnoDB</a> и <a href="https://www.mysql.com/">MySQL</a>, или <a href="https://lucene.apache.org/">Lucene</a> и <a href="https://www.elastic.co/">Elasticsearch</a>.</p>
<p>Подобно MySQL и Elasticsearch, Milvus также построен на базе библиотек с открытым исходным кодом, таких как <a href="https://github.com/facebookresearch/faiss">Faiss</a>, <a href="https://github.com/nmslib/hnswlib">HNSW</a>, <a href="https://github.com/spotify/annoy">Annoy</a>, которые нацелены на предоставление поисковых функций и обеспечение производительности поиска. Однако было бы несправедливо сводить Milvus лишь к слою поверх Faiss, поскольку он хранит, извлекает, анализирует векторы и, как и любая другая база данных, предоставляет стандартный интерфейс для CRUD-операций. Кроме того, Milvus может похвастаться такими возможностями, как:</p>
<ul>
<li>шардинг и разделение</li>
<li>Репликация</li>
<li>Аварийное восстановление</li>
<li>Баланс нагрузки</li>
<li>Парсер или оптимизатор запросов</li>
</ul>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/database_d912320ea7.png" alt="Vector database" class="doc-image" id="vector-database" />
   </span> <span class="img-wrapper"> <span>Векторная база данных</span> </span></p>
<p>Чтобы получить более полное представление о том, что такое векторная база данных, читайте блог <a href="https://zilliz.com/learn/what-is-vector-database">здесь</a>.</p>
<h3 id="A-cloud-native-first-approach" class="common-anchor-header">Первый облачно-нативный подход</h3><p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/image_2_be82d762db.png" alt="Could-native approach" class="doc-image" id="could-native-approach" />
   </span> <span class="img-wrapper"> <span>Нативный подход</span> </span></p>
<h4 id="From-shared-nothing-to-shared-storage-then-to-shared-something" class="common-anchor-header">От общего ничего, к общему хранилищу, затем к общему чему-то</h4><p>Традиционные базы данных используют архитектуру "общего ничего", при которой узлы распределенных систем независимы, но связаны сетью. Память и хранилище не разделяются между узлами. Однако <a href="https://docs.snowflake.com/en/user-guide/intro-key-concepts.html">Snowflake</a> произвела революцию в отрасли, представив архитектуру "общего хранения", в которой вычисления (обработка запросов) отделены от хранения (хранение базы данных). Архитектура с общим хранилищем позволяет базам данных достичь большей доступности, масштабируемости и уменьшить дублирование данных. Под влиянием Snowflake многие компании начали использовать облачную инфраструктуру для хранения данных, а локальное хранилище - для кэширования. Такая архитектура баз данных называется "общее что-то" и сегодня стала основной в большинстве приложений.</p>
<p>Помимо архитектуры "общее что-то", Milvus поддерживает гибкое масштабирование каждого компонента за счет использования Kubernetes для управления механизмом исполнения и разделения сервисов чтения, записи и других сервисов с помощью микросервисов.</p>
<h4 id="Database-as-a-service-DBaaS" class="common-anchor-header">База данных как услуга (DBaaS)</h4><p>База данных как услуга - горячая тенденция, поскольку многие пользователи не только заботятся об обычном функционале базы данных, но и жаждут более разнообразных услуг. Это означает, что помимо традиционных CRUD-операций наша база данных должна расширять спектр услуг, которые она может предоставлять, например управление базой данных, транспортировка данных, начисление, визуализация и т. д.</p>
<h4 id="Synergy-with-the-broader-open-source-ecosystem" class="common-anchor-header">Синергия с более широкой экосистемой открытых исходных кодов</h4><p>Еще одна тенденция в разработке баз данных - использование синергии между базой данных и другими облачными инфраструктурами. В случае с Milvus она опирается на некоторые системы с открытым исходным кодом. Например, Milvus использует <a href="https://etcd.io/">etcd</a> для хранения метаданных. В нем также используется очередь сообщений - тип асинхронного взаимодействия между сервисами, используемый в архитектуре микросервисов, который может помочь экспортировать инкрементные данные.</p>
<p>В будущем мы надеемся создать Milvus на базе инфраструктур искусственного интеллекта, таких как <a href="https://spark.apache.org/">Spark</a> или <a href="https://www.tensorflow.org/">Tensorflow</a>, и интегрировать Milvus с потоковыми движками, чтобы лучше поддерживать унифицированную потоковую и пакетную обработку для удовлетворения различных потребностей пользователей Milvus.</p>
<h2 id="The-design-principles-of-Milvus-20" class="common-anchor-header">Принципы проектирования Milvus 2.0<button data-href="#The-design-principles-of-Milvus-20" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>Milvus 2.0, как наша облачная нативная векторная база данных нового поколения, построена на следующих трех принципах.</p>
<h3 id="Log-as-data" class="common-anchor-header">Журнал как данные</h3><p>Журнал в базе данных последовательно записывает все изменения, внесенные в данные. Как показано на рисунке ниже, слева направо расположены &quot;старые данные&quot; и &quot;новые данные&quot;. Журналы располагаются в порядке возрастания времени. В Milvus есть механизм глобального таймера, назначающего одну глобально уникальную и автоинкрементную временную метку.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/Frame_1_8_6e40211f44.png" alt="Logs" class="doc-image" id="logs" />
   </span> <span class="img-wrapper"> <span>Журналы</span> </span></p>
<p>В Milvus 2.0 брокер журналов служит основой системы: все операции по вставке и обновлению данных должны проходить через брокер журналов, а рабочие узлы выполняют CRUD-операции, подписываясь на журналы и потребляя их.</p>
<h3 id="Duality-of-table-and-log" class="common-anchor-header">Двойственность таблицы и журнала</h3><p>И таблица, и журнал - это данные, и это всего лишь две разные формы. Таблицы - это ограниченные данные, а журналы - неограниченные. Журналы можно преобразовать в таблицы. В случае с Milvus он агрегирует журналы с помощью окна обработки из TimeTick. На основе последовательности журналов несколько журналов объединяются в один небольшой файл, называемый снимком журнала. Затем эти снимки журнала объединяются в сегмент, который можно использовать по отдельности для балансировки нагрузки.</p>
<h3 id="Log-persistency" class="common-anchor-header">Постоянство журнала</h3><p>Постоянство журналов - одна из сложных проблем, с которой сталкиваются многие базы данных. Хранение журналов в распределенной системе обычно зависит от алгоритмов репликации.</p>
<p>В отличие от таких баз данных, как <a href="https://aws.amazon.com/rds/aurora/">Aurora</a>, <a href="https://hbase.apache.org/">HBase</a>, <a href="https://www.cockroachlabs.com/">Cockroach DB</a> и <a href="https://en.pingcap.com/">TiDB</a>, Milvus использует новаторский подход и представляет систему публикации-подписки (pub/sub) для хранения и персистентности журналов. Система pub/sub аналогична очереди сообщений в <a href="https://kafka.apache.org/">Kafka</a> или <a href="https://pulsar.apache.org/">Pulsar</a>. Все узлы в системе могут использовать журналы. В Milvus такая система называется брокером журналов. Благодаря лог-брокеру журналы отделены от сервера, что обеспечивает отсутствие статичности в Milvus и возможность быстрого восстановления после сбоя системы.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/log_broker_cafe889835.png" alt="Log broker" class="doc-image" id="log-broker" />
   </span> <span class="img-wrapper"> <span>Брокер журналов</span> </span></p>
<h2 id="Building-a-vector-database-for-scalable-similarity-search" class="common-anchor-header">Создание базы данных векторов для масштабируемого поиска по сходству<button data-href="#Building-a-vector-database-for-scalable-similarity-search" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>Построенная на базе популярных библиотек векторного поиска, включая Faiss, ANNOY, HNSW и другие, Milvus была разработана для поиска сходства в плотных векторных наборах данных, содержащих миллионы, миллиарды и даже триллионы векторов.</p>
<h3 id="Standalone-and-cluster" class="common-anchor-header">Автономный и кластерный</h3><p>Milvus предлагает два способа развертывания - автономный или кластерный. В автономном Milvus, поскольку все узлы развернуты вместе, мы можем рассматривать Milvus как единый процесс. В настоящее время Milvus standalone полагается на MinIO и etcd для сохранения данных и хранения метаданных. В будущих релизах мы надеемся отказаться от этих двух сторонних зависимостей, чтобы обеспечить простоту системы Milvus. Кластер Milvus включает в себя восемь компонентов микросервисов и три сторонних зависимости: MinIO, etcd и Pulsar. Pulsar служит брокером журналов и обеспечивает сервисы pub/sub журналов.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/standalone_and_cluster_7558f56e8c.png" alt="Standalone and cluster" class="doc-image" id="standalone-and-cluster" />
   </span> <span class="img-wrapper"> <span>Автономный и кластерный</span> </span></p>
<h3 id="A-bare-bones-skeleton-of-the-Milvus-architecture" class="common-anchor-header">Голый скелет архитектуры Milvus</h3><p>Milvus отделяет поток данных от потока управления и разделен на четыре уровня, которые независимы с точки зрения масштабируемости и аварийного восстановления.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/Milvus_architecture_b7743a4a7f.png" alt="Milvus architecture" class="doc-image" id="milvus-architecture" />
   </span> <span class="img-wrapper"> <span>Архитектура Milvus</span> </span></p>
<h4 id="Access-layer" class="common-anchor-header">Уровень доступа</h4><p>Уровень доступа выступает в качестве лица системы, открывая конечную точку клиентского соединения внешнему миру. Он отвечает за обработку клиентских соединений, статическую проверку, базовые динамические проверки пользовательских запросов, перенаправление запросов, сбор и возврат результатов клиенту. Сам прокси не имеет статической проверки и предоставляет единые адреса доступа и сервисы во внешний мир через компоненты балансировки нагрузки (Nginx, Kubernetess Ingress, NodePort и LVS). Milvus использует архитектуру массивно-параллельной обработки (MPP), где прокси возвращают результаты, собранные с рабочих узлов после глобальной агрегации и постобработки.</p>
<h4 id="Coordinator-service" class="common-anchor-header">Служба координатора</h4><p>Служба координаторов - это "мозг" системы, отвечающий за управление узлами топологии кластера, балансировку нагрузки, генерацию временных меток, объявление данных и управление ими. Для подробного объяснения функций каждого сервиса-координатора читайте <a href="https://milvus.io/docs/v2.0.x/four_layers.md#Coordinator-service">техническую документацию Milvus</a>.</p>
<h4 id="Worker-nodes" class="common-anchor-header">Рабочие узлы</h4><p>Рабочий узел, или узел выполнения, действует как конечный узел системы, выполняя инструкции, выданные службой координатора, и команды языка манипулирования данными (DML), инициированные прокси. Рабочий узел в Milvus аналогичен узлу данных в <a href="https://hadoop.apache.org/">Hadoop</a> или региональному серверу в HBase. Каждому типу рабочего узла соответствует свой коорд-сервис. Для подробного объяснения функций каждого рабочего узла читайте <a href="https://milvus.io/docs/v2.0.x/four_layers.md#Worker-nodes">техническую документацию Milvus</a>.</p>
<h4 id="Storage" class="common-anchor-header">Хранилище</h4><p>Хранилище - это краеугольный камень Milvus, отвечающий за сохранение данных. Слой хранения делится на три части:</p>
<ul>
<li><strong>Метахранилище:</strong> Отвечает за хранение снимков метаданных, таких как схема коллекции, статус узла, контрольные точки потребления сообщений и т. д. Milvus полагается на etcd для этих функций, а Etcd также берет на себя ответственность за регистрацию и проверку работоспособности сервисов.</li>
<li><strong>Брокер журналов:</strong> Система pub/sub, поддерживающая воспроизведение и отвечающая за сохранение потоковых данных, надежное асинхронное выполнение запросов, уведомления о событиях и возврат результатов запросов. Когда узлы выполняют восстановление после простоя, брокер журналов обеспечивает целостность инкрементных данных с помощью воспроизведения брокером журналов. В кластере Milvus в качестве лог-брокера используется Pulsar, а в автономном режиме - RocksDB. В качестве лог-брокеров также могут использоваться сервисы потокового хранения данных, такие как Kafka и Pravega.</li>
<li><strong>Объектное хранилище:</strong> Хранит файлы моментальных снимков журналов, файлы скалярных/векторных индексов и промежуточные результаты обработки запросов. Milvus поддерживает <a href="https://aws.amazon.com/s3/">AWS S3</a> и <a href="https://azure.microsoft.com/en-us/services/storage/blobs/">Azure Blob</a>, а также <a href="https://min.io/">MinIO</a>, легкий сервис хранения объектов с открытым исходным кодом. В связи с высокой задержкой доступа и тарификацией запросов в сервисах объектного хранения Milvus вскоре будет поддерживать кэш-пулы на базе памяти/SSD и разделение данных на "горячие" и "холодные" для повышения производительности и снижения затрат.</li>
</ul>
<h3 id="Data-Model" class="common-anchor-header">Модель данных</h3><p>Модель данных организует данные в базе данных. В Milvus все данные организованы по коллекциям, осколкам, разделам, сегментам и сущностям.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/Data_model_1_5d6bb43673.png" alt="Data model 1" class="doc-image" id="data-model-1" />
   </span> <span class="img-wrapper"> <span>Модель данных 1</span> </span></p>
<h4 id="Collection" class="common-anchor-header">Коллекция</h4><p>Коллекцию в Milvus можно сравнить с таблицей в реляционной системе хранения данных. Коллекция - это самая большая единица данных в Milvus.</p>
<h4 id="Shard" class="common-anchor-header">Осколок</h4><p>Чтобы в полной мере использовать возможности параллельных вычислений кластеров при записи данных, коллекции в Milvus должны распределять операции записи данных по разным узлам. По умолчанию одна коллекция содержит два шарда. В зависимости от объема набора данных в коллекции может быть больше шардов. В Milvus используется метод хэширования мастер-ключа для разделения на шарды.</p>
<h4 id="Partition" class="common-anchor-header">Раздел</h4><p>В одном шарде также может быть несколько разделов. Под разделом в Milvus понимается набор данных, помеченных одной и той же меткой в коллекции. Распространенные методы разделения включают разделение по дате, полу, возрасту пользователя и т. д. Создание разделов может принести пользу процессу запроса, поскольку огромные данные можно отфильтровать по метке раздела.</p>
<p>В сравнении, шардинг больше направлен на масштабирование возможностей при записи данных, а разделение - на повышение производительности системы при чтении данных.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/Data_model_2_044a443751.png" alt="Data model 2" class="doc-image" id="data-model-2" />
   </span> <span class="img-wrapper"> <span>Модель данных 2</span> </span></p>
<h4 id="Segments" class="common-anchor-header">Сегменты</h4><p>Внутри каждого раздела существует множество небольших сегментов. Сегмент - это наименьшая единица для планирования системы в Milvus. Существует два типа сегментов: растущие и закрытые. Растущие сегменты подписываются узлами запросов. Пользователь Milvus продолжает записывать данные в растущие сегменты. Когда размер растущего сегмента достигает верхнего предела (по умолчанию 512 МБ), система не позволяет записывать дополнительные данные в этот растущий сегмент, таким образом, сегмент запечатывается. На запечатанных сегментах строятся индексы.</p>
<p>Для доступа к данным в реальном времени система считывает данные как в растущих сегментах, так и в запечатанных.</p>
<h4 id="Entity" class="common-anchor-header">Сущности</h4><p>Каждый сегмент содержит огромное количество сущностей. Сущность в Milvus эквивалентна строке в традиционной базе данных. Каждая сущность имеет уникальное поле первичного ключа, которое также может быть сгенерировано автоматически. Сущности также должны содержать временную метку (ts) и векторное поле - ядро Milvus.</p>
<h2 id="About-the-Deep-Dive-Series" class="common-anchor-header">О серии глубоких погружений<button data-href="#About-the-Deep-Dive-Series" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>После <a href="https://milvus.io/blog/2022-1-25-annoucing-general-availability-of-milvus-2-0.md">официального объявления об общей доступности</a> Milvus 2.0 мы организовали эту серию блогов Milvus Deep Dive, чтобы предоставить углубленную интерпретацию архитектуры и исходного кода Milvus. В этой серии блогов рассматриваются следующие темы:</p>
<ul>
<li><a href="https://milvus.io/blog/deep-dive-1-milvus-architecture-overview.md">Обзор архитектуры Milvus</a></li>
<li><a href="https://milvus.io/blog/deep-dive-2-milvus-sdk-and-api.md">API и Python SDK</a></li>
<li><a href="https://milvus.io/blog/deep-dive-3-data-processing.md">Обработка данных</a></li>
<li><a href="https://milvus.io/blog/deep-dive-4-data-insertion-and-data-persistence.md">Управление данными</a></li>
<li><a href="https://milvus.io/blog/deep-dive-5-real-time-query.md">Запрос в реальном времени</a></li>
<li><a href="https://milvus.io/blog/deep-dive-7-query-expression.md">Скалярный механизм выполнения</a></li>
<li><a href="https://milvus.io/blog/deep-dive-6-oss-qa.md">Система контроля качества</a></li>
<li><a href="https://milvus.io/blog/deep-dive-8-knowhere.md">Векторный механизм выполнения</a></li>
</ul>
