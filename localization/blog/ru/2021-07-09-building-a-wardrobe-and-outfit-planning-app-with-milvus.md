---
id: building-a-wardrobe-and-outfit-planning-app-with-milvus.md
title: Обзор системы
author: Yu Fang
date: 2021-07-09T06:30:06.439Z
desc: >-
  Узнайте, как Milvus, векторная база данных с открытым исходным кодом,
  используется компанией Mozat для создания приложения, предлагающего
  персональные рекомендации по стилю и систему поиска изображений.
cover: assets.zilliz.com/mozat_blog_0ea9218c71.jpg
tag: Scenarios
canonicalUrl: >-
  https://zilliz.com/blog/building-a-wardrobe-and-outfit-planning-app-with-milvus
---
<custom-h1>Создание приложения для планирования гардероба и нарядов с помощью Milvus</custom-h1><p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/stylepedia_1_5f239a8d48.png" alt="stylepedia-1.png" class="doc-image" id="stylepedia-1.png" />
   </span> <span class="img-wrapper"> <span>stylepedia-1.png</span> </span></p>
<p>Основанная в 2003 году, <a href="http://www.mozat.com/home">Mozat</a> - это стартап со штаб-квартирой в Сингапуре и офисами в Китае и Саудовской Аравии. Компания специализируется на создании приложений для социальных сетей, общения и стиля жизни. <a href="https://stylepedia.com/">Stylepedia</a> - это приложение для гардероба, созданное Mozat, которое помогает пользователям открывать для себя новые стили и общаться с другими людьми, увлеченными модой. Среди его ключевых особенностей - возможность создания цифрового гардероба, персонализированные рекомендации по стилю, функциональность социальных сетей и инструмент поиска изображений, позволяющий находить вещи, похожие на те, что вы видели в Интернете или в реальной жизни.</p>
<p><a href="https://milvus.io">Milvus</a> используется для работы системы поиска изображений в Stylepedia. Приложение работает с тремя типами изображений: изображениями пользователей, изображениями товаров и модными фотографиями. Каждое изображение может включать в себя один или несколько элементов, что еще больше усложняет каждый запрос. Чтобы быть полезной, система поиска по изображениям должна быть точной, быстрой и стабильной. Эти характеристики закладывают прочный технический фундамент для добавления в приложение новых функций, таких как предложения нарядов и рекомендации модного контента.</p>
<h2 id="System-overview" class="common-anchor-header">Обзор системы<button data-href="#System-overview" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/stylepedia_system_process_8e7e2ab3e4.png" alt="stylepedia-system-process.png" class="doc-image" id="stylepedia-system-process.png" />
   </span> <span class="img-wrapper"> <span>stylepedia-system-process.png</span> </span></p>
<p>Система поиска изображений делится на оффлайн и онлайн компоненты.</p>
<p>В автономном режиме изображения векторизуются и помещаются в векторную базу данных (Milvus). В процессе обработки данных соответствующие изображения товаров и модные фотографии преобразуются в 512-мерные векторы признаков с помощью моделей обнаружения объектов и извлечения признаков. Затем векторные данные индексируются и добавляются в векторную базу данных.</p>
<p>В режиме онлайн выполняется запрос к базе данных изображений, и пользователю возвращаются похожие изображения. Как и в автономном режиме, изображение запроса обрабатывается моделями обнаружения объектов и выделения признаков для получения вектора признаков. Используя вектор признаков, Milvus ищет похожие векторы TopK и получает соответствующие им идентификаторы изображений. Наконец, после постобработки (фильтрации, сортировки и т. д.) возвращается коллекция изображений, схожих с изображением запроса.</p>
<h2 id="Implementation" class="common-anchor-header">Реализация<button data-href="#Implementation" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><p>Реализация разбита на четыре модуля:</p>
<ol>
<li>Обнаружение одежды</li>
<li>Извлечение признаков</li>
<li>Поиск векторного сходства</li>
<li>Постобработка</li>
</ol>
<h3 id="Garment-detection" class="common-anchor-header">Обнаружение одежды</h3><p>В модуле обнаружения одежды в качестве модели обнаружения объектов используется <a href="https://pytorch.org/hub/ultralytics_yolov5/">YOLOv5</a>, одноэтапная система обнаружения целей на основе якорей, благодаря своему небольшому размеру и возможности делать выводы в режиме реального времени. Она предлагает четыре размера моделей (YOLOv5s/m/l/x), и у каждого конкретного размера есть свои плюсы и минусы. Модели большего размера работают лучше (более высокая точность), но требуют гораздо больше вычислительной мощности и работают медленнее. Поскольку в данном случае объекты относительно крупные и их легко обнаружить, достаточно самой маленькой модели, YOLOv5s.</p>
<p>Предметы одежды на каждом изображении распознаются и вырезаются, чтобы служить исходными данными для модели извлечения признаков, используемой в последующей обработке. Одновременно модель обнаружения объектов предсказывает классификацию одежды в соответствии с заранее определенными классами (топы, верхняя одежда, брюки, юбки, платья и ромперы).</p>
<h3 id="Feature-extraction" class="common-anchor-header">Извлечение признаков</h3><p>Ключом к поиску сходства является модель извлечения признаков. Обрезанные изображения одежды встраиваются в 512-мерные векторы с плавающей запятой, которые представляют их атрибуты в машиночитаемом формате числовых данных. Применяется методология <a href="https://github.com/Joon-Park92/Survey_of_Deep_Metric_Learning">глубокого метрического обучения (DML)</a> с <a href="https://arxiv.org/abs/1905.11946">EfficientNet</a> в качестве базовой модели.</p>
<p>Метрическое обучение направлено на обучение модуля нелинейного извлечения признаков на основе CNN (или кодера) уменьшать расстояние между векторами признаков, соответствующими одному классу образцов, и увеличивать расстояние между векторами признаков, соответствующими разным классам образцов. В данном сценарии один и тот же класс образцов относится к одному и тому же предмету одежды.</p>
<p>EfficientNet учитывает как скорость, так и точность при равномерном масштабировании ширины, глубины и разрешения сети. В качестве сети извлечения признаков используется EfficientNet-B4, а на выходе конечного полностью связанного слоя - признаки изображения, необходимые для проведения поиска векторного сходства.</p>
<h3 id="Vector-similarity-search" class="common-anchor-header">Поиск векторного сходства</h3><p>Milvus - это векторная база данных с открытым исходным кодом, поддерживающая операции создания, чтения, обновления и удаления (CRUD), а также поиск в триллионбайтных наборах данных практически в режиме реального времени. В Stylepedia она используется для крупномасштабного поиска векторных сходств, поскольку обладает высокой эластичностью, стабильностью, надежностью и молниеносной скоростью. Milvus расширяет возможности широко используемых библиотек векторных индексов (Faiss, NMSLIB, Annoy и др.) и предоставляет набор простых и интуитивно понятных API, позволяющих пользователям выбрать идеальный тип индекса для конкретного сценария.</p>
<p>Учитывая требования сценария и масштаб данных, разработчики Stylepedia использовали дистрибутив Milvus только для процессоров в паре с индексом HNSW. Две индексированные коллекции, одна для товаров, а другая для модных фотографий, созданы для обеспечения различных функциональных возможностей приложения. Каждая коллекция делится на шесть разделов на основе результатов обнаружения и классификации, чтобы сузить область поиска. Milvus выполняет поиск по десяткам миллионов векторов за миллисекунды, обеспечивая оптимальную производительность при низкой стоимости разработки и минимальном потреблении ресурсов.</p>
<h3 id="Post-processing" class="common-anchor-header">Постобработка</h3><p>Чтобы улучшить сходство между результатами поиска изображений и запрошенным изображением, мы используем фильтрацию по цвету и ключевым меткам (длина рукава, длина одежды, стиль воротника и т. д.) для отсеивания неподходящих изображений. Кроме того, используется алгоритм оценки качества изображений, чтобы убедиться, что изображения более высокого качества будут представлены пользователям первыми.</p>
<h2 id="Application" class="common-anchor-header">Приложение<button data-href="#Application" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><h3 id="User-uploads-and-image-search" class="common-anchor-header">Загрузка изображений пользователями и их поиск</h3><p>Пользователи могут делать фотографии своей одежды и загружать их в свой цифровой шкаф Stylepedia, а затем получать изображения товаров, наиболее похожие на загруженные ими.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/stylepedia_search_results_0568e20dc0.png" alt="stylepedia-search-results.png" class="doc-image" id="stylepedia-search-results.png" />
   </span> <span class="img-wrapper"> <span>stylepedia-search-results.png</span> </span></p>
<h3 id="Outfit-suggestions" class="common-anchor-header">Предложения нарядов</h3><p>Проведя поиск по сходству в базе данных Stylepedia, пользователи могут найти модные фотографии, содержащие определенный предмет одежды. Это может быть новая одежда, которую кто-то думает приобрести, или что-то из собственной коллекции, что можно носить или сочетать с другими вещами. Затем, благодаря кластеризации предметов, с которыми они часто сочетаются, создаются предложения по выбору нарядов. Например, черная байкерская куртка может сочетаться с самыми разными вещами, такими как черные джинсы-скинни. Затем пользователи могут просмотреть соответствующие модные фотографии, где это сочетание встречается в выбранной формуле.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/stylepedia_jacket_outfit_e84914da9e.png" alt="stylepedia-jacket-outfit.png" class="doc-image" id="stylepedia-jacket-outfit.png" />
   </span> <span class="img-wrapper"> <span>stylepedia-jacket-outfit.png</span> </span></p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/stylepedia_jacket_snapshot_25f53cc09b.png" alt="stylepedia-jacket-snapshot.png" class="doc-image" id="stylepedia-jacket-snapshot.png" />
   </span> <span class="img-wrapper"> <span>stylepedia-jacket-snapshot.png</span> </span></p>
<h3 id="Fashion-photograph-recommendations" class="common-anchor-header">Рекомендации по модным фотографиям</h3><p>Основываясь на истории просмотров, симпатиях и содержимом цифрового шкафа пользователя, система рассчитывает сходство и предоставляет рекомендации по модным фотографиям, которые могут представлять интерес.</p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/stylepedia_user_wardrobe_6770c856b9.png" alt="stylepedia-user-wardrobe.png" class="doc-image" id="stylepedia-user-wardrobe.png" />
   </span> <span class="img-wrapper"> <span>stylepedia-user-wardrobe.png</span> </span></p>
<p>
  
   <span class="img-wrapper"> <img translate="no" src="https://assets.zilliz.com/stylepedia_streetsnap_rec_901601a34d.png" alt="stylepedia-streetsnap-rec.png" class="doc-image" id="stylepedia-streetsnap-rec.png" />
   </span> <span class="img-wrapper"> <span>stylepedia-streetsnap-rec.png</span> </span></p>
<p>Объединив методы глубокого обучения и компьютерного зрения, Mozat смог создать быструю, стабильную и точную систему поиска по сходству изображений, используя Milvus для работы различных функций приложения Stylepedia.</p>
<h2 id="Dont-be-a-stranger" class="common-anchor-header">Не будьте незнакомцем<button data-href="#Dont-be-a-stranger" class="anchor-icon" translate="no">
      <svg translate="no"
        aria-hidden="true"
        focusable="false"
        height="20"
        version="1.1"
        viewBox="0 0 16 16"
        width="16"
      >
        <path
          fill="#0092E4"
          fill-rule="evenodd"
          d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"
        ></path>
      </svg>
    </button></h2><ul>
<li>Найдите Milvus на <a href="https://github.com/milvus-io/milvus/">GitHub</a> и внесите в него свой вклад.</li>
<li>Общайтесь с сообществом через <a href="https://join.slack.com/t/milvusio/shared_invite/zt-e0u4qu3k-bI2GDNys3ZqX1YCJ9OM~GQ">Slack</a>.</li>
<li>Общайтесь с нами в <a href="https://twitter.com/milvusio">Twitter</a>.</li>
</ul>
